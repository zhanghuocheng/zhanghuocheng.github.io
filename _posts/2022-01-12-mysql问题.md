



# mysql问题

### [1、int(20)中20的涵义](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#1int20中20的涵义)  


**1、** 是指显示字符的长度。20表示最大显示宽度为20，但仍占4字节存储，存储范围不变；

**2、** 不影响内部存储，只是影响带 zerofill 定义的 int 时，前面补多少个 0，易于报表展示


### [3、MySQL里记录货币用什么字段类型好](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#3mysql里记录货币用什么字段类型好)  


NUMERIC和DECIMAL类型被MySQL实现为同样的类型，这在SQL92标准允许。他们被用于保存值，该值的准确精度是极其重要的值，例如与金钱有关的数据。当声明一个类是这些类型之一时，精度和规模的能被(并且通常是)指定。

**例如：**

salary DECIMAL(9,2)

在这个例子中，9(precision)代表将被用于存储值的总的小数位数，而2(scale)代表将被用于存储小数点后的位数。

因此，在这种情况下，能被存储在salary列中的值的范围是从-9999999.99到9999999.99。


### [4、数据库自增主键可能遇到什么问题。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#4数据库自增主键可能遇到什么问题。)  


使用自增主键对数据库做分库分表，可能出现诸如主键重复等的问题。解决方案的话，简单点的话可以考虑使用UUID哈

自增主键会产生表锁，从而引发问题

自增主键可能用完问题。


### [5、从锁的类别角度讲，MySQL都有哪些锁呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#5从锁的类别角度讲mysql都有哪些锁呢)  




### [6、索引失效情况？ ==校验SQL语句是否使用了索引方式为：](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#6索引失效情况-校验sql语句是否使用了索引方式为：)  


**在SQL语句前面使用explain关键字==**

**1、** like以%开头索引无效，当like以&结尾，索引有效。

**2、** or语句前后没有同事使用索引，当且仅当or语句查询条件的前后列均为索引时，索引生效。

**3、** 组合索引，使用的不是第一列索引时候，索引失效，即最左匹配规则。

**4、** 数据类型出现隐式转换，如varchar不加单引号的时候可能会自动转换为int类型，这个时候索引失效。

**5、** 在索引列上使用IS NULL或者 IS NOT NULL 时候，索引失效，因为索引是不索引空值得。

**6、** 在索引字段上使用，NOT、 <>、！= 、时候是不会使用索引的，对于这样的处理只会进行全表扫描。

**7、** 对索引字段进行计算操作，函数操作时不会使用索引。

**8、** 当全表扫描速度比索引速度快的时候不会使用索引。


### [7、优化特定类型的查询语句](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#7优化特定类型的查询语句)  


**平时积累吧：**

**1、** 比如使用select 具体字段代替 select *

**2、** 使用count(*) 而不是count(列名)

**3、** 在不影响业务的情况，使用缓存

**4、** explain 分析你的SQL


### [8、MySQL数据库作发布系统的存储，一天五万条以上的增量，预计运维三年,怎么优化？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#8mysql数据库作发布系统的存储一天五万条以上的增量预计运维三年,怎么优化)  


a、设计良好的数据库结构，允许部分数据冗余，尽量避免join查询，提高效率。

b、选择合适的表字段数据类型和存储引擎，适当的添加索引。

c、MySQL库主从读写分离。

d、找规律分表，减少单表中的数据量提高查询速度。

e。添加缓存机制，比如Memcached，apc等。

f、不经常改动的页面，生成静态页面。

g、书写高效率的SQL。比如 SELECT * FROM TABEL 改为 SELECT field_1, field_2, field_3 FROM TABLE.


### [9、MyISAM表格将在哪里存储，并且还提供其存储格式？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#9myisam表格将在哪里存储并且还提供其存储格式)  


每个MyISAM表格以三种格式存储在磁盘上：

·“.frm”文件存储表定义

·数据文件具有“.MYD”（MYData）扩展名

索引文件具有“.MYI”（MYIndex）扩展名


### [10、为什么要优化](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题，中级面试题，大汇总.md#10为什么要优化)  


**1、** 系统的吞吐量瓶颈往往出现在数据库的访问速度上

**2、** 随着应用程序的运行，数据库的中的数据会越来越多，处理时间会相应变慢

**3、** 数据是存放在磁盘上的，读写速度无法和内存相比

优化原则：减少系统瓶颈，减少资源占用，增加系统的反应速度


### 11、MySQL中都有哪些触发器？

### 12、SQL 约束有哪几种呢？

### 13、试述视图的优点？

### 14、说一下大表查询的优化方案

### 15、大表数据查询，怎么优化

### 16、慢查询日志

### 17、解释MySQL外连接、内连接与自连接的区别

### 18、MySQL的binlog有有几种录入格式？分别有什么区别？

### 19、使用索引查询一定能提高查询的性能吗？为什么

### 20、UNION与UNION ALL的区别？

### 21、你是否做过主从一致性校验，如果有，怎么做的，如果没有，你打算怎么做？

### 22、字段为什么要求定义为not null？

### 23、drop、delete与truncate的区别

### 24、主键、外键和索引的区别？

### 25、MySQL的复制原理以及流程

### 26、100.MySQL一条SQL加锁分析

### 27、存储引擎选择

### 28、drop、delete与truncate的区别

### 29、什么是脏读？幻读？不可重复读？

### [1、什么是最左前缀原则？什么是最左匹配原则？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#1什么是最左前缀原则什么是最左匹配原则)  


最左前缀原则，就是最左优先，在创建多列索引时，要根据业务需求，where子句中使用最频繁的一列放在最左边。

当我们创建一个组合索引的时候，如(k1,k2,k3)，相当于创建了（k1）、(k1,k2)和(k1,k2,k3)三个索引，这就是最左匹配原则。。


### [2、myisamchk是用来做什么的？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#2myisamchk是用来做什么的)  


它用来压缩MyISAM表，这减少了磁盘或内存使用。


### [3、4.说说分库与分表的设计](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#34说说分库与分表的设计)  


分库分表方案，分库分表中间件，分库分表可能遇到的问题

**「分库分表方案:」**

**1、** 水平分库：以字段为依据，按照一定策略（hash、range等），将一个库中的数据拆分到多个库中。

**2、** 水平分表：以字段为依据，按照一定策略（hash、range等），将一个表中的数据拆分到多个表中。

**3、** 垂直分库：以表为依据，按照业务归属不同，将不同的表拆分到不同的库中。

**4、** 垂直分表：以字段为依据，按照字段的活跃性，将表中字段拆到不同的表（主表和扩展表）中。

**「常用的分库分表中间件：」**

**1、** sharding-jdbc（当当）

**2、** Mycat

**3、** TDDL（淘宝）

**4、** Oceanus(58同城数据库中间件)

**5、** vitess（谷歌开发的数据库中间件）

**6、** Atlas(Qihoo 360)

**「分库分表可能遇到的问题」**

**1、** 事务问题：需要用分布式事务啦

**2、** 跨节点Join的问题：解决这一问题可以分两次查询实现

**3、** 跨节点的count,order by,group by以及聚合函数问题：分别在各个节点上得到结果后在应用程序端进行合并。

**4、** 数据迁移，容量规划，扩容等问题

**5、** ID问题：数据库被切分后，不能再依赖数据库自身的主键生成机制啦，最简单可以考虑UUID

**6、** 跨分片的排序分页问题（后台加大pagesize处理？）




### [5、如何删除索引](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#5如何删除索引)  


根据索引名删除普通索引、唯一索引、全文索引：`alter table 表名 drop KEY 索引名`

```
alter table user_index drop KEY name;
alter table user_index drop KEY id_card;
alter table user_index drop KEY information;
```

**删除主键索引：**`alter table 表名 drop primary key`（因为主键只有一个）。这里值得注意的是，如果主键自增长，那么不能直接执行此操作（自增长依赖于主键索引）：

![99_3.png][99_3.png]

**需要取消自增长再行删除：**

```
alter table user_index
-- 重新定义字段
MODIFY id int,
drop PRIMARY KEY
```

但通常不会删除主键，因为设计主键一定与业务逻辑无关。


### [6、什么是数据库连接池?为什么需要数据库连接池呢?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#6什么是数据库连接池为什么需要数据库连接池呢)  


**连接池基本原理：**

数据库连接池原理：在内部对象池中，维护一定数量的数据库连接，并对外暴露数据库连接的获取和返回方法。

**应用程序和数据库建立连接的过程：**

**1、** 通过TCP协议的三次握手和数据库服务器建立连接

**2、** 发送数据库用户账号密码，等待数据库验证用户身份

**3、** 完成身份验证后，系统可以提交SQL语句到数据库执行

**4、** 把连接关闭，TCP四次挥手告别。

**数据库连接池好处：**

**1、** 资源重用 (连接复用)

**2、** 更快的系统响应速度

**3、** 新的资源分配手段

**4、** 统一的连接管理，避免数据库连接泄漏


### [7、列对比运算符是什么？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#7列对比运算符是什么)  


在SELECT语句的列比较中使用=，<>，<=，<，> =，>，<<，>>，<=>，AND，OR或LIKE运算符。


### [8、按照锁的粒度分，数据库锁有哪些呢？锁机制与InnoDB锁算法](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#8按照锁的粒度分数据库锁有哪些呢锁机制与innodb锁算法)  


按锁粒度分有：表锁，页锁，行锁

按锁机制分有：乐观锁，悲观锁


### [9、LIKE声明中的％和_是什么意思？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#9like声明中的％和_是什么意思)  


％对应于0个或更多字符，_只是LIKE语句中的一个字符。

**如何在Unix和MySQL时间戳之间进行转换？**

UNIX_TIMESTAMP是从MySQL时间戳转换为Unix时间戳的命令

FROM_UNIXTIME是从Unix时间戳转换为MySQL时间戳的命令


### [10、如何定位及优化SQL语句的性能问题？创建的索引有没有被使用到?或者说怎么才可以知道这条语句运行很慢的原因？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题及答案，企业真面试题.md#10如何定位及优化sql语句的性能问题创建的索引有没有被使用到或者说怎么才可以知道这条语句运行很慢的原因)  


对于低性能的SQL语句的定位，最重要也是最有效的方法就是使用执行计划，MySQL提供了explain命令来查看语句的执行计划。 我们知道，不管是哪种数据库，或者是哪种数据库引擎，在对一条SQL语句进行执行的过程中都会做很多相关的优化，**对于查询语句，最重要的优化方式就是使用索引**。 而**执行计划，就是显示数据库引擎对于SQL语句的执行的详细情况，其中包含了是否使用索引，使用什么索引，使用的索引的相关信息等**。

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_7.png#alt=99%5C_7.png)

执行计划包含的信息 **id** 有一组数字组成。表示一个查询中各个子查询的执行顺序;

**1、** id相同执行顺序由上至下。

**2、** id不同，id值越大优先级越高，越先被执行。

**3、** id为null时表示一个结果集，不需要使用它查询，常出现在包含union等查询语句中。

**select_type** 每个子查询的查询类型，一些常见的查询类型。

| id   | select_type  | description                               |
| ---- | ------------ | ----------------------------------------- |
| 1    | SIMPLE       | 不包含任何子查询或union等查询             |
| 2    | PRIMARY      | 包含子查询最外层查询就显示为 PRIMARY      |
| 3    | SUBQUERY     | 在select或 where字句中包含的查询          |
| 4    | DERIVED      | from字句中包含的查询                      |
| 5    | UNION        | 出现在union后的查询语句中                 |
| 6    | UNION RESULT | 从UNION中获取结果集，例如上文的第三个例子 |


**table** 查询的数据表，当从衍生表中查数据时会显示 x 表示对应的执行计划id **partitions** 表分区、表创建的时候可以指定通过那个列进行表分区。 举个例子：

```
create table tmp (
id int unsigned not null AUTO_INCREMENT,
name varchar(255),
PRIMARY KEY (id)
) engine = innodb
partition by key (id) partitions 5;
```

**type**(非常重要，可以看到有没有走索引) 访问类型

**1、** ALL 扫描全表数据

**2、** index 遍历索引

**3、** range 索引范围查找

**4、** index_subquery 在子查询中使用 ref

**5、** unique_subquery 在子查询中使用 eq_ref

**6、** ref_or_null 对Null进行索引的优化的 ref

**7、** fulltext 使用全文索引

**8、** ref 使用非唯一索引查找数据

**9、** eq_ref 在join查询中使用PRIMARY KEYorUNIQUE NOT NULL索引关联。

**10、**  **possible_keys** 可能使用的索引，注意不一定会使用。查询涉及到的字段上若存在索引，则该索引将被列出来。当该列为 NULL时就要考虑当前的SQL是否需要优化了。

**11、**  **key** 显示MySQL在查询中实际使用的索引，若没有使用索引，显示为NULL。

**12、**  **TIPS**:查询中若使用了覆盖索引(覆盖索引：索引的数据覆盖了需要查询的所有数据)，则该索引仅出现在key列表中

**13、**  **key_length** 索引长度

**14、**  **ref** 表示上述表的连接匹配条件，即哪些列或常量被用于查找索引列上的值

**15、**  **rows** 返回估算的结果集数目，并不是一个准确的值。

**16、**  **extra** 的信息非常丰富，常见的有：

**17、** Using index 使用覆盖索引

**18、** Using where 使用了用where子句来过滤结果集

**19、** Using filesort 使用文件排序，使用非索引列进行排序时出现，非常消耗性能，尽量优化。

**20、** Using temporary 使用了临时表 sql优化的目标可以参考阿里开发手册

**推荐**

SQL性能优化的目标：至少要达到 range 级别，要求是ref级别，如果可以是consts最好

**说明：**

**1、** consts 单表中最多只有一个匹配行（主键或者唯一索引），在优化阶段即可读取到数据。

**2、** ref 指的是使用普通的索引（normal index）。

**3、** range 对索引进行范围检索。

**反例：**

explain表的结果，type=index，索引物理文件全扫描，速度非常慢，这个index级别比较range还低，与全表扫描是小巫见大巫。


### 11、MySQL 的内连接、左连接、右连接有什么区别？

### 12、索引的基本原理

### 13、varchar(50)中50的涵义

### 14、MySql, Oracle，Sql Service的区别

### 15、什么是通用SQL函数？

### 16、创建索引有什么原则呢？

### 17、MySQL的复制原理以及流程

### 18、你是如何监控你们的数据库的？你们的慢日志都是怎么查询的？

### 19、简述在MySQL数据库中MyISAM和InnoDB的区别

### 20、日志的存放形式

### 21、创建索引的原则？

### 22、Blob和text有什么区别？

### 23、主从同步延迟的原因

### 24、说说分库与分表的设计

### 25、MYSQL支持事务吗？

### 26、MySQL有关权限的表都有哪几个

### 27、什么是触发器？触发器的使用场景有哪些？

### 28、简述有哪些索引和作用

### 29、数据库中的事务是什么?

### [1、索引的分类?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#1索引的分类)  


**1、** 从存储结构上来划分：BTree索引（B-Tree或B+Tree索引），Hash索引，full-index全文索引，R-Tree索引。这里所描述的是索引存储时保存的形式，

**2、** 从应用层次来分：普通索引，唯一索引，复合索引

**3、** 根据中数据的物理顺序与键值的逻辑（索引）顺序关系：聚集索引，非聚集索引。

平时讲的索引类型一般是指在应用层次的划分。

就像手机分类：安卓手机，IOS手机 与 华为手机，苹果手机，OPPO手机一样。

普通索引：

即一个索引只包含单个列，一个表可以有多个单列索引

唯一索引：

索引列的值必须唯一，但允许有空值

复合索引：

多列值组成一个索引，专门用于组合搜索，其效率大于索引合并

聚簇索引(聚集索引)：

并不是一种单独的索引类型，而是一种数据存储方式。具体细节取决于不同的实现，InnoDB的聚簇索引其实就是在同一个结构中保存了B-Tree索引(技术上来说是B+Tree)和数据行。

非聚簇索引：不是聚簇索引，就是非聚簇索引


### [2、索引具体采用那种数据结构呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#2索引具体采用那种数据结构呢)  


常见的MySQL主要有两种结构：hash索引和B+Tree索引，我们使用的是innodb引擎，默认的是B+树。


### [3、索引算法有哪些？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#3索引算法有哪些)  


索引算法有 BTree算法和Hash算法

**BTree算法**

BTree是最常用的MySQL数据库索引算法，也是MySQL默认的算法。因为它不仅可以被用在=,>,>=,<,<=和between这些比较操作符上，而且还可以用于like操作符，只要它的查询条件是一个不以通配符开头的常量， 例如：

```
-- 只要它的查询条件是一个不以通配符开头的常量
select * from user where name like 'jack%'; 
-- 如果一通配符开头，或者没有使用常量，则不会使用索引，例如： 
select * from user where name like '%jack';
```

**Hash算法**

Hash Hash索引只能用于对等比较，例如=,<=>（相当于=）操作符。由于是一次定位数据，不像BTree索引需要从根节点到枝节点，最后才能访问到页节点这样多次IO访问，所以检索效率远高于BTree索引。


### [4、备份计划，MySQLdump以及xtranbackup的实现原理](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#4备份计划mysqldump以及xtranbackup的实现原理)  


**备份计划**

**1、** 视库的大小来定，一般来说 100G 内的库，可以考虑使用 MySQLdump 来做，因为 MySQLdump更加轻巧灵活，备份时间选在业务低峰期，可以每天进行都进行全量备份(MySQLdump 备份出来的文件比较小，压缩之后更小)。

**2、** 100G 以上的库，可以考虑用 xtranbackup 来做，备份速度明显要比 MySQLdump 要快。一般是选择一周一个全备，其余每天进行增量备份，备份时间为业务低峰期。

**备份恢复时间**

**1、** 物理备份恢复快，逻辑备份恢复慢

**2、** 这里跟机器，尤其是硬盘的速率有关系，以下列举几个仅供参考

**3、** 20G的2分钟（MySQLdump）

**4、** 80G的30分钟(MySQLdump)

**5、** 111G的30分钟（MySQLdump)

**6、** 288G的3小时（xtra)

**7、** 3T的4小时（xtra)

**8、** 逻辑导入时间一般是备份时间的5倍以上

**备份恢复失败如何处理**

首先在恢复之前就应该做足准备工作，避免恢复的时候出错。比如说备份之后的有效性检查、权限检查、空间检查等。如果万一报错，再根据报错的提示来进行相应的调整。

**MySQLdump和xtrabackup实现原理**

**MySQLdump**

MySQLdump 属于逻辑备份。加入–single-transaction 选项可以进行一致性备份。后台进程会先设置 session 的事务隔离级别为 RR(SET SESSION TRANSACTION ISOLATION LEVELREPEATABLE READ)，之后显式开启一个事务(START TRANSACTION /*!40100 WITH CONSISTENTSNAPSHOT */)，这样就保证了该事务里读到的数据都是事务事务时候的快照。之后再把表的数据读取出来。如果加上–master-data=1 的话，在刚开始的时候还会加一个数据库的读锁(FLUSH TABLES WITH READ LOCK),等开启事务后，再记录下数据库此时 binlog 的位置(showmaster status)，马上解锁，再读取表的数据。等所有的数据都已经导完，就可以结束事务

**Xtrabackup:**

xtrabackup 属于物理备份，直接拷贝表空间文件，同时不断扫描产生的 redo 日志并保存下来。最后完成 innodb 的备份后，会做一个 flush engine logs 的操作(老版本在有 bug，在5.6 上不做此操作会丢数据)，确保所有的 redo log 都已经落盘(涉及到事务的两阶段提交

- 概念，因为 xtrabackup 并不拷贝 binlog，所以必须保证所有的 redo log 都落盘，否则可能会丢最后一组提交事务的数据)。这个时间点就是 innodb 完成备份的时间点，数据文件虽然不是一致性的，但是有这段时间的 redo 就可以让数据文件达到一致性(恢复的时候做的事情)。然后还需要 flush tables with read lock，把 myisam 等其他引擎的表给备份出来，备份完后解锁。这样就做到了完美的热备。


### [5、BLOB和TEXT有什么区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#5blob和text有什么区别)  


BLOB是一个二进制对象，可以容纳可变数量的数据。TEXT是一个不区分大小写的BLOB。

BLOB和TEXT类型之间的唯一区别在于对BLOB值进行排序和比较时区分大小写，对TEXT值不区分大小写。


### [6、百万级别或以上的数据如何删除](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#6百万级别或以上的数据如何删除)  


关于索引：由于索引需要额外的维护成本，因为索引文件是单独存在的文件,所以当我们对数据的增加,修改,删除,都会产生额外的对索引文件的操作,这些操作需要消耗额外的IO,会降低增/改/删的执行效率。所以，在我们删除数据库百万级别数据的时候，查询MySQL官方手册得知删除数据的速度和创建的索引数量是成正比的。

**1、** 所以我们想要删除百万数据的时候可以先删除索引（此时大概耗时三分多钟）

**2、** 然后删除其中无用数据（此过程需要不到两分钟）

**3、** 删除完成后重新创建索引(此时数据较少了)创建索引也非常快，约十分钟左右。

**4、** 与之前的直接删除绝对是要快速很多，更别说万一删除中断,一切删除会回滚。那更是坑了。


### [7、乐观锁：](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#7乐观锁：)  


乐观锁的“乐观情绪”体现在，它认为数据的变动不会太频繁。因此，它允许多个事务同时对数据进行变动。实现方式：乐观锁一般会使用版本号机制或CAS算法实现。


### [8、B树和B+树的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#8b树和b+树的区别)  


**1、** 在B树中，你可以将键和值存放在内部节点和叶子节点；但在B+树中，内部节点都是键，没有值，叶子节点同时存放键和值。

**2、** B+树的叶子节点有一条链相连，而B树的叶子节点各自独立。

![99_4.png][99_4.png]


### [9、InnoDB引擎的4大特性](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#9innodb引擎的4大特性)  


**1、** 插入缓冲（insert buffer)

**2、** 二次写(double write)

**3、** 自适应哈希索引(ahi)

**4、** 预读(read ahead)


### [10、有多少种日志](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL高级面试题整理及答案.md#10有多少种日志)  


innodb两种日志redo和undo。


### 11、MySQL的binlog有几种录入格式？分别有什么区别？

### 12、优化WHERE子句

### 13、什么是内连接、外连接、交叉连接、笛卡尔积呢？

### 14、聚簇索引和非聚簇索引，在查询数据的时候有区别吗？为什么？

### 15、SQL 约束有哪几种？

### 16、MySQL中有哪些不同的表格？

### 17、索引使用场景

### 18、MySQL为什么这么设计

### 19、drop、delete与truncate的区别

### 20、MySQL中TEXT数据类型的最大长度

### 21、CHAR和VARCHAR的区别？

### 22、怎么创建索引的，有什么好处，有哪些分类

### 23、MySQL中有哪几种锁？

### 24、你怎么知道SQL语句性能是高还是低

### 25、InnoDB引擎的4大特性，了解过吗

### 26、如何写sql能够有效的使用到复合索引。

### 27、使用悲观锁

### 28、Myql中的事务回滚机制概述

### 29、说说MySQL 的基础架构图

### [1、一个6亿的表a，一个3亿的表b，通过外间tid关联，你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#1一个6亿的表a一个3亿的表b通过外间tid关联你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。)  


**1、** 如果A表TID是自增长,并且是连续的,B表的ID为索引 select * from a,b where a.tid = b.id and a.tid>500000 limit 200;

**2、** 如果A表的TID不是连续的,那么就需要使用覆盖索引.TID要么是主键,要么是辅助索引,B表ID也需要有索引。 select * from b , (select tid from a limit 50000,200) a where b.id = a .tid;


### [2、SQL语句优化的一些方法](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#2sql语句优化的一些方法)  


**1、** 对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。

**2、** 应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：

```
select id from t where num is null
-- 可以在num上设置默认值0，确保表中num列没有null值，然后这样查询：
select id from t where num=0
```

**3、** 应尽量避免在 where 子句中使用!=或<>操作符，否则引擎将放弃使用索引而进行全表扫描。

**4、** 应尽量避免在 where 子句中使用or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：

```
select id from t where num=10 or num=20
-- 可以这样查询：
select id from t where num=10 union all select id from t where num=20
```

5、in 和 not in 也要慎用，否则会导致全表扫描，如：

```
select id from t where num in(1,2,3) 
-- 对于连续的数值，能用 between 就不要用 in 了：
select id from t where num between 1 and 3
```

**6、** 下面的查询也将导致全表扫描：select id from t where name like ‘%李%’若要提高效率，可以考虑全文检索。

**7、** 如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。然 而，如果在编译时建立访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：

```
select id from t where num=@num
-- 可以改为强制查询使用索引：
select id from t with(index(索引名)) where num=@num
```

**8、** 应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：

```
select id from t where num/2=100
-- 应改为:
select id from t where num=100*2
```

**9、** 应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：

```
select id from t where substring(name,1,3)=’abc’
-- name以abc开头的id应改为:
select id from t where name like ‘abc%’
```

**10、** 不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。


### [3、什么是数据库连接池?为什么需要数据库连接池呢?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#3什么是数据库连接池为什么需要数据库连接池呢)  


「连接池基本原理：」 数据库连接池原理：在内部对象池中，维护一定数量的数据库连接，并对外暴露数据库连接的获取和返回方法。

**「应用程序和数据库建立连接的过程：」**

**1、** 通过TCP协议的三次握手和数据库服务器建立连接

**2、** 发送数据库用户账号密码，等待数据库验证用户身份

**3、** 完成身份验证后，系统可以提交SQL语句到数据库执行

**4、** 把连接关闭，TCP四次挥手告别。

**「数据库连接池好处：」**

**1、** 资源重用 (连接复用)

**2、** 更快的系统响应速度

**3、** 新的资源分配手段

**4、** 统一的连接管理，避免数据库连接泄漏


### [4、事物的四大特性(ACID)介绍一下?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#4事物的四大特性acid介绍一下)  


关系性数据库需要遵循ACID规则，具体内容如下：

![99_6.png][99_6.png]

**1、** 原子性：

事务是最小的执行单位，不允许分割。事务的原子性确保动作要么全部完成，要么完全不起作用；

**2、** 一致性：

执行事务前后，数据保持一致，多个事务对同一个数据读取的结果是相同的；

**3、** 隔离性：

并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的；

**4、** 持久性：

一个事务被提交之后。它对数据库中数据的改变是持久的，即使数据库发生故障也不应该对其有任何影响。


### [5、索引分类？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#5索引分类)  


**单列索引**

**1、** 普通索引：MySQL中基本索引类型，没有什么限制，允许在定义索引的列中插入重复值和空值，纯粹为了查询数据更快一点。

**2、** 唯一索引：索引列中的值必须是唯一的，但是允许为空值，

**3、** 主键索引：是一种特殊的唯一索引，不允许有空值。

**组合索引：**

多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用，使用组合索引时遵循最左前缀集合。

**全文索引：**

只有在MyISAM引擎上才能使用，只能在CHAR,VARCHAR,TEXT    类型字段上使用全文索引，介绍了要求，说说什么是全文索引，就是在一堆文字中，通过其中的某个关键字等，就能找到该字段所属的记录行，比如有"你是个靓仔，靓女 ..."   通过靓仔，可能就可以找到该条记录

**空间索引：**

空间索引是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有四种，GEOMETRY、POINT、LINESTRING、POLYGON。在创建空间索引时，使用SPATIAL关键字。要求，引擎为MyISAM，创建空间索引的列，必须将其声明为NOT NULL。


### [6、锁的优化策略](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#6锁的优化策略)  


1\、读写分离

2\、分段加锁

3\、减少锁持有的时间

4\、多个线程尽量以相同的顺序去获取资源

不能将锁的粒度过于细化，不然可能会出现线程的加锁和释放次数过多，反而效率不如一次加一把大锁。


### [7、limit 1000000 加载很慢的话，你是怎么解决的呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#7limit-1000000-加载很慢的话你是怎么解决的呢)  


**方案一：如果id是连续的，可以这样，返回上次查询的最大记录(偏移量)，再往下limit**

```
select id，name from employee where id>1000000 limit 10.
```

**方案二：在业务允许的情况下限制页数：**

建议跟业务讨论，有没有必要查这么后的分页啦。因为绝大多数用户都不会往后翻太多页。

**方案三：order by + 索引（id为索引）**

```
select id，name from employee order by id  limit 1000000，10
```

**方案四：利用延迟关联或者子查询优化超多分页场景。（先快速定位需要获取的id段，然后再关联）**

```
SELECT a.* FROM employee a, (select id from employee where 条件 LIMIT 1000000,10 ) b where a.id=b.id
```


### [8、什么是事务的隔离级别？MySQL的默认隔离级别是什么？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#8什么是事务的隔离级别mysql的默认隔离级别是什么)  


为了达到事务的四大特性，数据库定义了4种不同的事务隔离级别，由低到高依次为Read uncommitted、Read committed、Repeatable read、Serializable，这四个级别可以逐个解决脏读、不可重复读、幻读这几类问题。

| 隔离级别         | 脏读 | 不可重复读 | 幻影读 |
| ---------------- | ---- | ---------- | ------ |
| READ-UNCOMMITTED | √    | √          | √      |
| READ-COMMITTED   | ×    | √          | √      |
| REPEATABLE-READ  | ×    | ×          | √      |
| SERIALIZABLE     |      |            |        |


**SQL 标准定义了四个隔离级别：**

**1、** READ-UNCOMMITTED(读取未提交)：

最低的隔离级别，允许读取尚未提交的数据变更，**可能会导致脏读、幻读或不可重复读**。

**2、** READ-COMMITTED(读取已提交)： 允许读取并发事务已经提交的数据，**可以阻止脏读，但是幻读或不可重复读仍有可能发生**。

**3、** REPEATABLE-READ(可重复读)：

对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，**可以阻止脏读和不可重复读，但幻读仍有可能发生**。

**4、** SERIALIZABLE(可串行化)：

最高的隔离级别，完全服从ACID的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，**该级别可以防止脏读、不可重复读以及幻读**。

**注意：**

**1、** 这里需要注意的是：MySQL 默认采用的 REPEATABLE_READ隔离级别 Oracle 默认采用的 READ_COMMITTED隔离级别

**2、** 事务隔离机制的实现基于锁机制和并发调度。其中并发调度使用的是MVVC（多版本并发控制），通过保存修改的旧版本信息来支持并发一致性读和回滚等特性。

**3、** 因为隔离级别越低，事务请求的锁越少，所以大部分数据库系统的隔离级别都是**READ-COMMITTED(读取提交内容):**，但是你要知道的是InnoDB 存储引擎默认使用 **REPEATABLE-READ（可重读）**并不会有任何性能损失。

**4、** InnoDB 存储引擎在 **分布式事务** 的情况下一般会用到**SERIALIZABLE(可串行化)**隔离级别。


### [9、视图的使用场景有哪些？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#9视图的使用场景有哪些)  


视图根本用途：简化sql查询，提高开发效率。如果说还有另外一个用途那就是兼容老的表结构

**下面是视图的常见使用场景：**

**1、** 重用SQL语句；

**2、** 简化复杂的SQL操作。在编写查询后，可以方便的重用它而不必知道它的基本查询细节；

**3、** 使用表的组成部分而不是整个表；

**4、** 保护数据。可以给用户授予表的特定部分的访问权限而不是整个表的访问权限；

**5、** 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。


### [10、MYSQL数据库服务器性能分析的方法命令有哪些?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题，高级面试题及附答案解析.md#10mysql数据库服务器性能分析的方法命令有哪些)  


Show status, 一些值得监控的变量值：

**1、** Bytes_received和Bytes_sent 和服务器之间来往的流量。

**2、** Com_*服务器正在执行的命令。

**3、** Created_*在查询执行期限间创建的临时表和文件。

**4、** Handler_*存储引擎操作。

**5、** Select_*不同类型的联接执行计划。

**6、** Sort_*几种排序信息。

Show profiles 是MySql用来分析当前会话SQL语句执行的资源消耗情况


### 11、列值为NULL时，查询是否会用到索引？

### 12、MySQL里记录货币用什么字段类型好

### 13、在高并发情况下，如何做到安全的修改同一行数据？

### 14、B+树在满足聚簇索引和覆盖索引的时候不需要回表查询数据，

### 15、SQL语言包括哪几部分？每部分都有哪些操作关键字？

### 16、优化特定类型的查询语句

### 17、什么是数据库事务？

### 18、谈谈MySQL的Explain

### 19、视图的优点，缺点，讲一下？

### 20、MyISAM Static和MyISAM Dynamic有什么区别？

### 21、隔离级别与锁的关系

### 22、如何优化长难的查询语句？有实战过吗？

### 23、B+Tree的页子节点都可以存放哪些东西？

### 24、SQL语句的语法顺序：

### 25、什么是锁？

### 26、你怎么看到为表格定义的所有索引？

### 27、MySQL里记录货币用什么字段类型比较好？

### 28、数据库的乐观锁和悲观锁。

### 29、MySQL有关权限的表都有哪几个？

### 30、索引不适合哪些场景

### [1、innoDB的B+Tree 存储整行数据和主键的值得区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#1innodb的b+tree-存储整行数据和主键的值得区别)  


**1、** 整行数据：innoDB的B+Tree存储了整行数据的是主键索引，也被成为聚凑索引。

**2、** 存储主键的值：成为非主键索引，也被称为非聚凑索引


### [2、读写分离常见方案？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#2读写分离常见方案)  


**1、** 应用程序根据业务逻辑来判断，增删改等写操作命令发给主库，查询命令发给备库。

**2、** 利用中间件来做代理，负责对数据库的请求识别出读还是写，并分发到不同的数据库中。（如：amoeba，MySQL-proxy）


### [3、六种关联查询](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#3六种关联查询)  


**1、** 交叉连接（CROSS JOIN）

**2、** 内连接（INNER JOIN）

**3、** 外连接（LEFT JOIN/RIGHT JOIN）

**4、** 联合查询（UNION与UNION ALL）

**5、** 全连接（FULL JOIN）

**6、** 交叉连接（CROSS JOIN）

```
SELECT * FROM A,B(,C)或者SELECT * FROM A CROSS JOIN B (CROSS JOIN C)#没有任何关联条件，结果是笛卡尔积，结果集会很大，没有意义，很少使用内连接（INNER JOIN）SELECT * FROM A,B WHERE A.id=B.id或者SELECT * FROM A INNER JOIN B ON A.id=B.id多表中同时符合某种条件的数据记录的集合，INNER JOIN可以缩写为JOIN
```

**内连接分为三类**

**1、** 等值连接：ON A.id=B.id

**2、** 不等值连接：ON A.id > B.id

**3、** 自连接：SELECT * FROM A T1 INNER JOIN A T2 ON T1.id=T2.pid

**外连接（LEFT JOIN/RIGHT JOIN）**

**左外连接：**

LEFT OUTER JOIN, 以左表为主，先查询出左表，按照ON后的关联条件匹配右表，没有匹配到的用NULL填充，可以简写成LEFT JOIN

**右外连接：**

RIGHT OUTER JOIN, 以右表为主，先查询出右表，按照ON后的关联条件匹配左表，没有匹配到的用NULL填充，可以简写成RIGHT JOIN

**联合查询（UNION与UNION ALL）**

```
SELECT * FROM A UNION SELECT * FROM B UNION ...
```

**1、** 就是把多个结果集集中在一起，UNION前的结果为基准，需要注意的是联合查询的列数要相等，相同的记录行会合并

**2、** 如果使用UNION ALL，不会合并重复的记录行

**3、** 效率 UNION 高于 UNION ALL

**全连接（FULL JOIN）**

```
SELECT * FROM A LEFT JOIN B ON A.id=B.id UNIONSELECT * FROM A RIGHT JOIN B ON A.id=B.id
```

MySQL不支持全连接

可以使用LEFT JOIN 和UNION和RIGHT JOIN联合使用

**有2张表**

1张R、1张S，R表有ABC三列，S表有CD两列，表中各有三条记录

**R表**

| A    | B    | C    |
| ---- | ---- | ---- |
| a1   | b1   | c1   |
| a2   | b2   | c2   |
| a3   | b3   | c3   |


**S表**

| C    | D    |
| ---- | ---- |
| c1   | d1   |
| c2   | d2   |
| c4   | d3   |


**交叉连接(笛卡尔积)**

SQL

```
select r.*,s.* from r,s
```

**结果**

| A    | B    | C    | C    | D    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | c1   | c1   | d1   |
| a2   | b2   | c2   | c1   | d1   |
| a3   | b3   | c3   | c1   | d1   |
| a1   | b1   | c1   | c2   | d2   |
| a2   | b2   | c2   | c2   | d2   |
| a3   | b3   | c3   | c2   | d2   |
| a1   | b1   | c1   | c4   | d3   |
| a2   | b2   | c2   | c4   | d3   |
| a3   | b3   | c3   | c4   | d3   |


**内连接结果**

SQL

```
select r.*,s.* from r inner join s on r.c=s.c
```

**结果**

| A    | B    | C    | C    | D    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | c1   | c1   | d1   |
| a2   | b2   | c2   | c2   | d2   |


**左连接结果**

SQL

```
select r.*,s.* from r left join s on r.c=s.c
```

**结果**

| A    | B    | C    | C    | D    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | c1   | c1   | d1   |
| a2   | b2   | c2   | c2   | d2   |
| a3   | b3   | c3   |      |      |


**右连接结果**

SQL

```
select r.*,s.* from r right join s on r.c=s.c
```

**结果**

| A    | B    | C    | C    | D    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | c1   | c1   | d1   |
| a2   | b2   | c2   | c2   | d2   |
|      |      |      | c4   | d3   |


**全表连接的结果（MySql不支持，Oracle支持）**

SQL

```
select r.*,s.* from r full join s on r.c=s.c
```

**结果**

| A    | B    | C    | C    | D    |
| ---- | ---- | ---- | ---- | ---- |
| a1   | b1   | c1   | c1   | d1   |
| a2   | b2   | c2   | c2   | d2   |
| a3   | b3   | c3   |      |      |
|      |      |      | c4   | d3   |



### [4、什么是存储过程？有哪些优缺点？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#4什么是存储过程有哪些优缺点)  


**存储过程**，就是一些编译好了的SQL语句，这些SQL语句代码像一个方法一样实现一些功能（对单表或多表的增删改查），然后给这些代码块取一个名字，在用到这个功能的时候调用即可。

**优点：**

**1、** 存储过程是一个预编译的代码块，执行效率比较高

**2、** 存储过程在服务器端运行，减少客户端的压力

**3、** 允许模块化程序设计，只需要创建一次过程，以后在程序中就可以调用该过程任意次，类似方法的复用

**4、** 一个存储过程替代大量T_SQL语句 ，可以降低网络通信量，提高通信速率

**5、** 可以一定程度上确保数据安全

**缺点：**

**1、** 调试麻烦

**2、** 可移植性不灵活

**3、** 重新编译问题


### [5、优化关联查询](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#5优化关联查询)  


**1、** 确定ON或者USING子句中是否有索引。

**2、** 确保GROUP BY和ORDER BY只有一个表中的列，这样MySQL才有可能使用索引。


### [6、主键和候选键有什么区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#6主键和候选键有什么区别)  


表格的每一行都由主键唯一标识,一个表只有一个主键。

主键也是候选键。按照惯例，候选键可以被指定为主键，并且可以用于任何外键引用。


### [7、既然提到了InnoDB使用户的B+树的索引模型](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#7既然提到了innodb使用户的b+树的索引模型)  


**那么你知道为什么采用B+树吗？这和Hash索引比较起来有什么缺点吗？**

因为hash索引底层是哈希表，哈希表是一种以key-value存储数据的结构，所以多个数据在存储关系上是完全没有任何顺序关系的，所以，对于区间查询是无法直接通过索引查询的，就需要全表扫描。所以，哈希索引只适用于等值查询的场景。而B+树是一种多路平衡查询树，所以他的节点是天然有序的（左子节点小于父节点，父节点小于右子节点），所以对于范围查询的时候不需要做全表扫描。


### [8、MySQL_fetch_array和MySQL_fetch_object的区别是什么？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#8mysql_fetch_array和mysql_fetch_object的区别是什么)  


以下是MySQL_fetch_array和MySQL_fetch_object的区别：

MySQL_fetch_array（） – 将结果行作为关联数组或来自数据库的常规数组返回。

MySQL_fetch_object – 从数据库返回结果行作为对象。


### [9、对于关系型数据库而言，索引是相当重要的概念，请回答有关索引的几个问题：](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#9对于关系型数据库而言索引是相当重要的概念请回答有关索引的几个问题：)  


**1、** 索引的目的是什么？

快速访问数据表中的特定信息，提高检索速度

创建唯一性索引，保证数据库表中每一行数据的唯一性。

加速表和表之间的连接

使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间

**2、** 索引对数据库系统的负面影响是什么？

负面影响：

创建索引和维护索引需要耗费时间，这个时间随着数据量的增加而增加；索引需要占用物理空间，不光是表需要占用数据空间，每个索引也需要占用物理空间；当对表进行增、删、改、的时候索引也要动态维护，这样就降低了数据的维护速度。

**3、** 为数据表建立索引的原则有哪些？

在最频繁使用的、用以缩小查询范围的字段上建立索引。

在频繁使用的、需要排序的字段上建立索引

**4、** 什么情况下不宜建立索引？

对于查询中很少涉及的列或者重复值比较多的列，不宜建立索引。

对于一些特殊的数据类型，不宜建立索引，比如文本字段（text）等


### [10、MySQL如何优化DISTINCT？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题大汇总，附答案.md#10mysql如何优化distinct)  


DISTINCT在所有列上转换为GROUP BY，并与ORDER BY子句结合使用。

1

SELECT DISTINCT t1.a FROM t1,t2 where t1.a=t2.a;


### 11、什么是幻读，脏读，不可重复读呢？

### 12、linux添加索引

### 13、B+树在满足聚簇索引和覆盖索引的时候不需要回表查询数据？

### 14、数据库中间件了解过吗，sharding jdbc，mycat？

### 15、为什么要使用视图？什么是视图？

### 16、NULL是什么意思

### 17、MySQL中InnoDB引擎的行锁是怎么实现的？

### 18、优化器的执行过程？

### 19、什么是最左前缀原则？什么是最左匹配原则

### 20、LIKE声明中的％和_是什么意思？

### 21、使用乐观锁

### 22、varchar(50)中50的涵义

### 23、主从同步延迟的解决办法

### 24、MySQL 遇到过死锁问题吗，你是如何解决的？

### 25、主键使用自增ID还是UUID，为什么？

### 26、什么是数据库事务？

### 27、怎么查询SQL语句是否使用了索引查询？

### 28、什么是死锁？怎么解决？

### 29、主键使用自增ID还是UUID？

### 30、MVCC熟悉吗，它的底层原理？

### [1、隔离级别与锁的关系](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#1隔离级别与锁的关系)  


回答这个问题，可以先阐述四种隔离级别，再阐述它们的实现原理。隔离级别就是依赖锁和MVCC实现的。


### [2、实践中如何优化MySQL](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#2实践中如何优化mysql)  


最好是按照以下顺序优化：

**1、** SQL语句及索引的优化

**2、** 数据库表结构的优化

**3、** 系统配置的优化

**4、** 硬件的优化

详细可以查看 [阿里P8架构师谈：MySQL慢查询优化、索引优化、以及表等优化总结](http://youzhixueyuan.com/MySQL-slow-query-optimization-index-optimization.html)


### [3、优化子查询](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#3优化子查询)  


**1、** 用关联查询替代

**2、** 优化GROUP BY和DISTINCT

**3、** 这两种查询据可以使用索引来优化，是最有效的优化方法

**4、** 关联查询中，使用标识列分组的效率更高

**5、** 如果不需要ORDER BY，进行GROUP BY时加ORDER BY NULL，MySQL不会再进行文件排序。

**6、** WITH ROLLUP超级聚合，可以挪到应用程序处理


### [4、前缀索引](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#4前缀索引)  


**1、** 语法：`index(field(10))`，使用字段值的前10个字符建立索引，默认是使用字段的全部内容建立索引。

**2、** 前提：前缀的标识度高。比如密码就适合建立前缀索引，因为密码几乎各不相同。

**3、** 实操的难度：在于前缀截取的长度。

**4、** 我们可以利用`select count(*)/count(distinct left(password,prefixLen));`，通过从调整`prefixLen`的值（从1自增）查看不同前缀长度的一个平均匹配度，接近1时就可以了（表示一个密码的前`prefixLen`个字符几乎能确定唯一一条记录）


### [5、MySQL5.6和MySQL5.7对索引做了哪些优化？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#5mysql56和mysql57对索引做了哪些优化)  


**1、** MySQL5.6引入了索引下推优化，默认是开启的。

**2、** 例子：user表中（a,b,c）构成一个索引。

**3、** select * from user where a='23' and b like '%eqw%' and c like 'dasd'。

**4、** 解释：如果没有索引下推原则，则MySQL会通过a='23' 先查询出一个对应的数据。然后返回到MySQL服务端。MySQL服务端再基于两个like模糊查询来校验and查询出的数据是否符合条件。这个过程就设计到回表操作。

**5、** 如果使用了索引下推技术，则MySQL会首先返回返回条件a='23'的数据的索引，然后根据模糊查询的条件来校验索引行数据是否符合条件，如果符合条件，则直接根据索引来定位对应的数据，如果不符合直接reject掉。因此，有了索引下推优化，可以在有like条件的情况下，减少回表的次数。


### [6、MySQL有关权限的表有哪几个呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#6mysql有关权限的表有哪几个呢)  


MySQL服务器通过权限表来控制用户对数据库的访问，权限表存放在MySQL数据库里，由MySQL_install_db脚本初始化。这些权限表分别user，db，table_priv，columns_priv和host。

**1、** user权限表：记录允许连接到服务器的用户帐号信息，里面的权限是全局级的。

**2、** db权限表：记录各个帐号在各个数据库上的操作权限。

**3、** table_priv权限表：记录数据表级的操作权限。

**4、** columns_priv权限表：记录数据列级的操作权限。

**5、** host权限表：配合db权限表对给定主机上数据库级操作权限作更细致的控制。这个权限表不受GRANT和REVOKE语句的影响。


### [7、MySQL中都有哪些触发器？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#7mysql中都有哪些触发器)  


MySQL 数据库中有六种触发器：

**1、** Before Insert

**2、** After Insert

**3、** Before Update

**4、** After Update

**5、** Before Delete

**6、** After Delete


### [8、大表怎么优化？分库分表了是怎么做的？分表分库了有什么问题？有用到中间件么？他们的原理知道么？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#8大表怎么优化分库分表了是怎么做的分表分库了有什么问题有用到中间件么他们的原理知道么)  


当MySQL单表记录数过大时，数据库的CRUD性能会明显下降，一些常见的优化措施如下：

**1、** 限定数据的范围： 务必禁止不带任何限制数据范围条件的查询语句。比如：我们当用户在查询订单历史的时候，我们可以控制在一个月的范围内。；

**2、** 读/写分离： 经典的数据库拆分方案，主库负责写，从库负责读；

**3、** 缓存： 使用MySQL的缓存，另外对重量级、更新少的数据可以考虑使用应用级别的缓存；

**还有就是通过分库分表的方式进行优化，主要有垂直分区、垂直分表和水平分区、水平分表**

**垂直分区**

**1、** 根据数据库里面数据表的相关性进行拆分。 例如，用户表中既有用户的登录信息又有用户的基本信息，可以将用户表拆分成两个单独的表，甚至放到单独的库做分库。

**2、** 简单来说垂直拆分是指数据表列的拆分，把一张列比较多的表拆分为多张表。 如下图所示，这样来说大家应该就更容易理解了。

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_9.png#alt=99%5C_9.png)

**垂直拆分的优点：**

可以使得行数据变小，在查询时减少读取的Block数，减少I/O次数。此外，垂直分区可以简化表的结构，易于维护。

**垂直拆分的缺点：**

主键会出现冗余，需要管理冗余列，并会引起Join操作，可以通过在应用层进行Join来解决。此外，垂直分区会让事务变得更加复杂；

**垂直分表**

把主键和一些列放在一个表，然后把主键和另外的列放在另一个表中

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_10.png#alt=99%5C_10.png)

**适用场景**

**1、** 如果一个表中某些列常用，另外一些列不常用

**2、** 可以使数据行变小，一个数据页能存储更多数据，查询时减少I/O次数

**缺点**

**1、** 有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，整个分表逻辑都会改变，扩展性较差

**2、** 对于应用层来说，逻辑算法增加开发成本

**3、** 管理冗余列，查询所有数据需要join操作

**水平分区**

**1、** 保持数据表结构不变，通过某种策略存储数据分片。这样每一片数据分散到不同的表或者库中，达到了分布式的目的。 水平拆分可以支撑非常大的数据量。

**2、** 水平拆分是指数据表行的拆分，表的行数超过200万行时，就会变慢，这时可以把一张的表的数据拆成多张表来存放。举个例子：我们可以将用户信息表拆分成多个用户信息表，这样就可以避免单一表数据量过大对性能造成影响。

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_11.png#alt=99%5C_11.png)

**1、** 水品拆分可以支持非常大的数据量。需要注意的一点是:分表仅仅是解决了单一表数据过大的问题，但由于表的数据还是在同一台机器上，其实对于提升MySQL并发能力没有什么意义，所以 **水平拆分最好分库** 。

**2、** 水平拆分能够支持非常大的数据量存储，应用端改造也少，但 **分片事务难以解决** ，跨界点Join性能较差，逻辑复杂。

《Java工程师修炼之道》的作者推荐 尽量不要对数据进行分片，因为拆分会带来逻辑、部署、运维的各种复杂度 ，一般的数据表在优化得当的情况下支撑千万以下的数据量是没有太大问题的。如果实在要分片，尽量选择客户端分片架构，这样可以减少一次和中间件的网络I/O。

**水平分表：**

表很大，分割后可以降低在查询时需要读的数据和索引的页数，同时也降低了索引的层数，提高查询次数

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_12.png#alt=99%5C_12.png)

**适用场景**

**1、** 表中的数据本身就有独立性，例如表中分表记录各个地区的数据或者不同时期的数据，特别是有些数据常用，有些不常用。

**2、** 需要把数据存放在多个介质上。

**水平切分的缺点**

**1、** 给应用增加复杂度，通常查询时需要多个表名，查询所有数据都需UNION操作

**2、** 在许多数据库应用中，这种复杂度会超过它带来的优点，查询时会增加读一个索引层的磁盘次数

**数据库分片的两种常见方案：**

**客户端代理：**

分片逻辑在应用端，封装在jar包中，通过修改或者封装JDBC层来实现。当当网的 **Sharding-JDBC** 、阿里的TDDL是两种比较常用的实现。

**中间件代理：**

在应用和数据中间加了一个代理层。分片逻辑统一维护在中间件服务中。** 我们现在谈的 Mycat** 、360的Atlas、网易的DDB等等都是这种架构的实现。

**分库分表后面临的问题**

**事务支持**

分库分表后，就成了分布式事务了。如果依赖数据库本身的分布式事务管理功能去执行事务，将付出高昂的性能代价； 如果由应用程序去协助控制，形成程序逻辑上的事务，又会造成编程方面的负担。

**跨库join**

只要是进行切分，跨节点Join的问题是不可避免的。但是良好的设计和切分却可以减少此类情况的发生。解决这一问题的普遍做法是分两次查询实现。在第一次查询的结果集中找出关联数据的id,根据这些id发起第二次请求得到关联数据。 分库分表方案产品

**跨节点的count,order by,group by以及聚合函数问题**

这些是一类问题，因为它们都需要基于全部数据集合进行计算。多数的代理都不会自动处理合并工作。解决方案：与解决跨节点join问题的类似，分别在各个节点上得到结果后在应用程序端进行合并。和join不同的是每个结点的查询可以并行执行，因此很多时候它的速度要比单一大表快很多。但如果结果集很大，对应用程序内存的消耗是一个问题。

**数据迁移，容量规划，扩容等问题**

来自淘宝综合业务平台团队，它利用对2的倍数取余具有向前兼容的特性（如对4取余得1的数对2取余也是1）来分配数据，避免了行级别的数据迁移，但是依然需要进行表级别的迁移，同时对扩容规模和分表数量都有限制。总得来说，这些方案都不是十分的理想，多多少少都存在一些缺点，这也从一个侧面反映出了Sharding扩容的难度。

**ID问题**

一旦数据库被切分到多个物理结点上，我们将不能再依赖数据库自身的主键生成机制。一方面，某个分区数据库自生成的ID无法保证在全局上是唯一的；另一方面，应用程序在插入数据之前需要先获得ID,以便进行SQL路由、一些常见的主键生成策略

UUID 使用UUID作主键是最简单的方案，但是缺点也是非常明显的。由于UUID非常的长，除占用大量存储空间外，最主要的问题是在索引上，在建立索引和基于索引进行查询时都存在性能问题。 **Twitter的分布式自增ID算法Snowflake** 在分布式系统中，需要生成全局UID的场合还是比较多的，twitter的snowflake解决了这种需求，实现也还是很简单的，除去配置信息，核心代码就是毫秒级时间41位 机器ID 10位 毫秒内序列12位。

**跨分片的排序分页问题**

一般来讲，分页时需要按照指定字段进行排序。当排序字段就是分片字段的时候，我们通过分片规则可以比较容易定位到指定的分片，而当排序字段非分片字段的时候，情况就会变得比较复杂了。为了最终结果的准确性，我们需要在不同的分片节点中将数据进行排序并返回，并将不同分片返回的结果集进行汇总和再次排序，最后再返回给用户。如下图所示：

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_13.png#alt=99%5C_13.png)


### [9、B+ Tree索引和Hash索引区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#9b+-tree索引和hash索引区别)  


**1、** hash索引适合等值查询，但是无法进行范围查询。

**2、** hash索引没办法利用索引完成排序。

**3、** hash索引不支持多列联合索引的最左匹配规则。

**4、** 如果有大量重复健值得情况下，hash索引的效率会很低，因为哈希碰撞问题。


### [10、数据库索引的原理，为什么要用 B+树，为什么不用二叉树？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题附答案解析，大汇总.md#10数据库索引的原理为什么要用-b+树为什么不用二叉树)  


可以从几个维度去看这个问题，查询是否够快，效率是否稳定，存储数据多少，以及查找磁盘次数，为什么不是二叉树，为什么不是平衡二叉树，为什么不是B树，而偏偏是B+树呢？

**为什么不是一般二叉树？**

如果二叉树特殊化为一个链表，相当于全表扫描。平衡二叉树相比于二叉查找树来说，查找效率更稳定，总体的查找速度也更快。

**为什么不是平衡二叉树呢？**

我们知道，在内存比在磁盘的数据，查询效率快得多。如果树这种数据结构作为索引，那我们每查找一次数据就需要从磁盘中读取一个节点，也就是我们说的一个磁盘块，但是平衡二叉树可是每个节点只存储一个键值和数据的，如果是B树，可以存储更多的节点数据，树的高度也会降低，因此读取磁盘的次数就降下来啦，查询效率就快啦。

**那为什么不是B树而是B+树呢？**

1）B+树非叶子节点上是不存储数据的，仅存储键值，而B树节点中不仅存储键值，也会存储数据。innodb中页的默认大小是16KB，如果不存储数据，那么就会存储更多的键值，相应的树的阶数（节点的子节点树）就会更大，树就会更矮更胖，如此一来我们查找数据进行磁盘的IO次数有会再次减少，数据查询的效率也会更快。

2）B+树索引的所有数据均存储在叶子节点，而且数据是按照顺序排列的，链表连着的。那么B+树使得范围查找，排序查找，分组查找以及去重查找变得异常简单。


### 11、MySQL的binlog有几种录入格式？分别有什么区别？

### 12、字段为什么要求定义为not null？

### 13、一条Sql的执行顺序？

### 14、SQL注入漏洞产生的原因？如何防止？

### 15、如何选择合适的分布式主键方案呢？

### 16、B树和B+树的区别，数据库为什么使用B+树而不是B树？

### 17、何时使用聚簇索引与非聚簇索引

### 18、你可以用什么来确保表格里的字段只接受特定范围里的值?

### 19、百万级别或以上的数据，你是如何删除的？

### 20、列设置为AUTO INCREMENT时，如果在表中达到最大值，会发生什么情况？

### 21、数据库的乐观锁和悲观锁是什么？怎么实现的？

### 22、什么是最左前缀原则？什么是最左匹配原则？

### 23、如果一个表有一列定义为TIMESTAMP，将发生什么？

### 24、说出一些数据库优化方面的经验?

### 25、select for update 含义

### 26、MyISAM索引与InnoDB索引的区别？

### 27、varchar(50)中50的涵义

### 28、完整性约束包括哪些？

### 29、索引的底层实现原理和优化

### 30、MySQL中int(20)和char(20)以及varchar(20)的区别

### [1、什么是存储过程？用什么来调用？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#1什么是存储过程用什么来调用)  


存储过程是一个预编译的SQL语句，优点是允许模块化的设计，就是说只需创建一次，以后在该程序中就可以调用多次。如果某次操作需要执行多次SQL，使用存储过程比单纯SQL语句执行要快。可以用一个命令对象来调用存储过程。


### [2、优化数据库的方法](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#2优化数据库的方法)  


**1、**  选取最适用的字段属性，尽可能减少定义字段宽度，尽量把字段设置NOTNULL，例如’省份’、’性别’最好适用ENUM

**2、**  使用连接(JOIN)来代替子查询

**3、**  适用联合(UNION)来代替手动创建的临时表

**4、**  事务处理

**5、**  锁定表、优化事务处理

**6、**  适用外键，优化锁定表

**7、**  建立索引

**8、**  优化查询语句


### [3、完整性约束包括哪些？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#3完整性约束包括哪些)  


数据完整性(Data Integrity)是指数据的精确(Accuracy)和可靠性(Reliability)。

**分为以下四类：**

**1、** 实体完整性：规定表的每一行在表中是惟一的实体。

**2、** 域完整性：是指表中的列必须满足某种特定的数据类型约束，其中约束又包括取值范围、精度等规定。

**3、** 参照完整性：是指两个表的主关键字和外关键字的数据应一致，保证了表之间的数据的一致性，防止了数据丢失或无意义的数据在数据库中扩散。

**4、** 用户定义的完整性：不同的关系数据库系统根据其应用环境的不同，往往还需要一些特殊的约束条件。用户定义的完整性即是针对某个特定关系数据库的约束条件，它反映某一具体应用必须满足的语义要求。

与表有关的约束：包括列约束(NOT NULL（非空约束）)和表约束(PRIMARY KEY、foreign key、check、UNIQUE) 。


### [4、使用B树的好处](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#4使用b树的好处)  


B树可以在内部节点同时存储键和值，因此，把频繁访问的数据放在靠近根节点的地方将会大大提高热点数据的查询效率。这种特性使得B树在特定数据重复多次查询的场景中更加高效。


### [5、视图有哪些特点？哪些使用场景？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#5视图有哪些特点哪些使用场景)  


**「视图特点：」**

**1、** 视图的列可以来自不同的表，是表的抽象和在逻辑意义上建立的新关系。

**2、** 视图是由基本表(实表)产生的表(虚表)。

**3、** 视图的建立和删除不影响基本表。

**4、** 对视图内容的更新(添加，删除和修改)直接影响基本表。

**5、** 当视图来自多个基本表时，不允许添加和删除数据。

「视图用途：」 简化sql查询，提高开发效率，兼容老的表结构。

**「视图的常见使用场景：」**

**1、** 重用SQL语句；

**2、** 简化复杂的SQL操作。

**3、** 使用表的组成部分而不是整个表；

**4、** 保护数据

**5、** 更改数据格式和表示。视图可返回与底层表的表示和格式不同的数据。


### [6、事务是如何通过日志来实现的](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#6事务是如何通过日志来实现的)  


因为事务在修改页时，要先记 undo，在记 undo 之前要记 undo 的 redo， 然后修改数据页，再记数据页修改的 redo。 Redo（里面包括 undo 的修改） 一定要比数据页先持久化到磁盘。

当事务需要回滚时，因为有 undo，可以把数据页回滚到前镜像的 状态，崩溃恢复时，如果 redo log 中事务没有对应的 commit 记录，那么需要用 undo把该事务的修改回滚到事务开始之前。

如果有 commit 记录，就用 redo 前滚到该事务完成时并提交掉。


### [7、索引有哪几种类型？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#7索引有哪几种类型)  


**1、** 主键索引: 数据列不允许重复，不允许为NULL，一个表只能有一个主键。

**2、** 唯一索引: 数据列不允许重复，允许为NULL值，一个表允许多个列创建唯一索引。

**3、** 普通索引: 基本的索引类型，没有唯一性的限制，允许为NULL值。

**4、** 全文索引：是目前搜索引擎使用的一种关键技术，对文本的内容进行分词、搜索。

**5、** 覆盖索引：查询列要被所建的索引覆盖，不必读取数据行

**6、** 组合索引：多列值组成一个索引，用于组合搜索，效率大于索引合并


### [8、谈谈六种关联查询，使用场景。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#8谈谈六种关联查询使用场景。)  


**1、** 交叉连接

**2、** 内连接

**3、** 外连接

**4、** 联合查询

**5、** 全连接

**6、** 交叉连接


### [9、试述视图的优点？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#9试述视图的优点)  


(1) 视图能够简化用户的操作 (2) 视图使用户能以多种角度看待同一数据； (3) 视图为数据库提供了一定程度的逻辑独立性； (4) 视图能够对机密数据提供安全保护。


### [10、MySQL自增主键用完了怎么办？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新2021年面试题及答案，汇总版.md#10mysql自增主键用完了怎么办)  


自增主键一般用int类型，一般达不到最大值，可以考虑提前分库分表的。


### 11、为什么要尽量设定一个主键？

### 12、存储时期

### 13、创建索引的三种方式

### 14、为什么要使用数据库

### 15、实践中如何优化MySQL

### 16、MySQL如何优化DISTINCT？

### 17、什么是触发器？触发器的使用场景有哪些？

### 18、如何显示前50行？

### 19、如何显示前50行？

### 20、B+树在满足聚簇索引和覆盖索引的时候不需要回表查询数据？

### 21、MySQL中有哪几种锁，列举一下？

### 22、超键、候选键、主键、外键分别是什么？

### 23、为什么官方建议使用自增长主键作为索引？

### 24、什么情况下设置了索引但无法使用

### 25、MySQL中有哪几种锁，列举一下？

### 26、什么是基本表？什么是视图？

### 27、索引哪些情况会失效

### 28、一个6亿的表a，一个3亿的表b，通过外间tid关联，你如何最快的查询出满足条件的第50000到第50200中的这200条数据记录。

### 29、视图有哪些特点？哪些使用场景？

### 30、数据表损坏的修复方式有哪些？

### [1、NOW（）和CURRENT_DATE（）有什么区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#1now和current_date有什么区别)  


NOW（）命令用于显示当前年份，月份，日期，小时，分钟和秒。

CURRENT_DATE（）仅显示当前年份，月份和日期。


### [2、CHAR和VARCHAR的区别？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#2char和varchar的区别)  


1.CHAR和VARCHAR类型在存储和检索方面有所不同

2.CHAR列长度固定为创建表时声明的长度，长度值范围是1到255

当CHAR值被存储时，它们被用空格填充到特定长度，检索CHAR值时需删除尾随空格。


### [3、主键索引与唯一索引的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#3主键索引与唯一索引的区别)  


**1、** 主键是一种约束，唯一索引是一种索引，两者在本质上是不同的。

**2、** 主键创建后一定包含一个唯一性索引，唯一性索引并不一定就是主键。

**3、** 唯一性索引列允许空值，而主键列不允许为空值。

**4、** 主键列在创建时，已经默认为空值 ++ 唯一索引了。

**5、** 一个表最多只能创建一个主键，但可以创建多个唯一索引。

**6、** 主键更适合那些不容易更改的唯一标识，如自动递增列、身份证号等。

**7、** 主键可以被其他表引用为外键，而唯一索引不能。 ？


### [4、MySQL中有哪些不同的表格？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#4mysql中有哪些不同的表格)  


**共有5种类型的表格：**

**1、** MyISAM

**2、** Heap

**3、** Merge

**4、** INNODB

**5、** ISAM


### [5、SQL的生命周期？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#5sql的生命周期)  


**1、** 应用服务器与数据库服务器建立一个连接

**2、** 数据库进程拿到请求sql

**3、** 解析并生成执行计划，执行

**4、** 读取数据到内存并进行逻辑处理

**5、** 通过步骤一的连接，发送结果到客户端

**6、** 关掉连接，释放资源

![](https://gitee.com/souyunkutech/souyunku-home/raw/master/images/souyunku-web/2020/5/2/049/50/99_8.png#alt=99%5C_8.png)


### [6、你怎么看到为表格定义的所有索引？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#6你怎么看到为表格定义的所有索引)  


索引是通过以下方式为表格定义的：

`SHOW INDEX FROM <tablename>;`


### [7、数据库为什么使用B+树而不是B树](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#7数据库为什么使用b+树而不是b树)  


**1、** B树只适合随机检索，而B+树同时支持随机检索和顺序检索；

**2、** B+树空间利用率更高，可减少I/O次数，磁盘读写代价更低。一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。这样的话，索引查找过程中就要产生磁盘I/O消耗。B+树的内部结点并没有指向关键字具体信息的指针，只是作为索引使用，其内部结点比B树小，盘块能容纳的结点中关键字数量更多，一次性读入内存中可以查找的关键字也就越多，相对的，IO读写次数也就降低了。而IO读写次数是影响索引检索效率的最大因素；

**3、** B+树的查询效率更加稳定。B树搜索有可能会在非叶子结点结束，越靠近根节点的记录查找时间越短，只要找到关键字即可确定记录的存在，其性能等价于在关键字全集内做一次二分查找。而在B+树中，顺序检索比较明显，随机检索时，任何关键字的查找都必须走一条从根节点到叶节点的路，所有关键字的查找路径长度相同，导致每一个关键字的查询效率相当。

**4、** B-树在提高了磁盘IO性能的同时并没有解决元素遍历的效率低下的问题。B+树的叶子节点使用指针顺序连接在一起，只要遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操作。

**5、** 增删文件（节点）时，效率更高。因为B+树的叶子节点包含所有关键字，并以有序的链表结构存储，这样可很好提高增删效率。


### [8、数据库三大范式是什么](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#8数据库三大范式是什么)  


第一范式：每个列都不可以再拆分。

第二范式：在第一范式的基础上，非主键列完全依赖于主键，而不能是依赖于主键的一部分。

第三范式：在第二范式的基础上，非主键列只依赖于主键，不依赖于其他非主键。

在设计数据库结构的时候，要尽量遵守三范式，如果不遵守，必须有足够的理由。比如性能。事实上我们经常会为了性能而妥协数据库的设计。


### [9、怎么优化SQL查询语句吗](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#9怎么优化sql查询语句吗)  


**1、** 对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引

**2、** 用索引可以提高查询

**3、** SELECT子句中避免使用*号，尽量全部大写SQL

**4、** 应尽量避免在 where 子句中对字段进行 is null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，使用 IS NOT NULL

**5、** where 子句中使用 or 来连接条件，也会导致引擎放弃使用索引而进行全表扫描

**6、** in 和 not in 也要慎用，否则会导致全表扫描


### [10、覆盖索引、回表等这些，了解过吗？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新基础面试题及答案整理.md#10覆盖索引回表等这些了解过吗)  


**1、** 覆盖索引： 查询列要被所建的索引覆盖，不必从数据表中读取，换句话说查询列要被所使用的索引覆盖。

**2、** 回表：二级索引无法直接查询所有列的数据，所以通过二级索引查询到聚簇索引后，再查询到想要的数据，这种通过二级索引查询出来的过程，就叫做回表。

网上这篇文章讲得很清晰：

[MySQL覆盖索引与回表](https://www.jianshu.com/p/8991cbca3854)


### 11、NULL是什么意思

### 12、MySQL中in 和exists的区别。

### 13、500台db，在最快时间之内重启。

### 14、MySQL数据库作发布系统的存储，一天五万条以上的增量，预计运维三年,怎么优化？

### 15、NOW（）和CURRENT_DATE（）有什么区别？

### 16、超键、候选键、主键、外键分别是什么？

### 17、关心过业务系统里面的sql耗时吗？统计过慢查询吗？对慢查询都怎么优化过？

### 18、为什么要使用视图？什么是视图？

### 19、索引的一些潜规则

### 20、myisamchk是用来做什么的？

### 21、如何在Unix和MySQL时间戳之间进行转换？

### 22、什么是索引？

### 23、日常工作中你是怎么优化SQL的？

### 24、MYSQL的主从延迟，你怎么解决？

### 25、索引的底层实现

### 26、SQL语言包括哪几部分？每部分都有哪些操作关键字？

### 27、500台db，在最快时间之内重启。

### 28、MySQL中TEXT数据类型的最大长度

### 29、数据库存储日期格式时，如何考虑时区转换问题？

### [1、对MySQL的锁了解吗](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#1对mysql的锁了解吗)  


当数据库有并发事务的时候，可能会产生数据的不一致，这时候需要一些机制来保证访问的次序，锁机制就是这样的一个机制。

就像酒店的房间，如果大家随意进出，就会出现多人抢夺同一个房间的情况，而在房间上装上锁，申请到钥匙的人才可以入住并且将房间锁起来，其他人只有等他使用完毕才可以再次使用。


### [2、MySQL中有哪几种锁？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#2mysql中有哪几种锁)  


1.表级锁：开销小，加锁快；不会出现死锁；锁定粒度大，发生锁冲突的概率最高，并发度最低。

2.行级锁：开销大，加锁慢；会出现死锁；锁定粒度最小，发生锁冲突的概率最低，并发度也最高。

3\、页面锁：开销和加锁时间界于表锁和行锁之间；会出现死锁；锁定粒度界于表锁和行锁之间，并发度一般。


### [3、MySQL一条SQL加锁分析](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#3mysql一条sql加锁分析)  


一条SQL加锁，可以分9种情况进行：

**1、** 组合一：id列是主键，RC隔离级别

**2、** 组合二：id列是二级唯一索引，RC隔离级别

**3、** 组合三：id列是二级非唯一索引，RC隔离级别

**4、** 组合四：id列上没有索引，RC隔离级别

**5、** 组合五：id列是主键，RR隔离级别

**6、** 组合六：id列是二级唯一索引，RR隔离级别

**7、** 组合七：id列是二级非唯一索引，RR隔离级别

**8、** 组合八：id列上没有索引，RR隔离级别

**9、** 组合九：Serializable隔离级别

### [4、索引能干什么?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#4索引能干什么)  


索引非常关键，尤其是当表中的数据量越来越大时，索引对于性能的影响愈发重要。 索引能够轻易将查询性能提高好几个数量级，总的来说就是可以明显的提高查询效率。


### [5、创建索引的三种方式](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#5创建索引的三种方式)  


在执行CREATE TABLE时创建索引

```
CREATE TABLE `employee` (
  `id` int(11) NOT NULL,
  `name` varchar(255) DEFAULT NULL,
  `age` int(11) DEFAULT NULL,
  `date` datetime DEFAULT NULL,
  `sex` int(1) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

使用ALTER TABLE命令添加索引

```
ALTER TABLE table_name ADD INDEX index_name (column);
```

使用CREATE INDEX命令创建

```
CREATE INDEX index_name ON table_name (column);
```


### [6、varchar与char的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#6varchar与char的区别)  


**char的特点**

**1、** char表示定长字符串，长度是固定的；

**2、** 如果插入数据的长度小于char的固定长度时，则用空格填充；

**3、** 因为长度固定，所以存取速度要比varchar快很多，甚至能快50%，但正因为其长度固定，所以会占据多余的空间，是空间换时间的做法；

**4、** 对于char来说，最多能存放的字符个数为255，和编码无关

**varchar的特点**

**1、** varchar表示可变长字符串，长度是可变的；

**2、** 插入的数据是多长，就按照多长来存储；

**3、** varchar在存取方面与char相反，它存取慢，因为长度不固定，但正因如此，不占据多余的空间，是时间换空间的做法；

**4、** 对于varchar来说，最多能存放的字符个数为65532

**总之**

结合性能角度（char更快）和节省磁盘空间角度（varchar更小），具体情况还需具体来设计数据库才是妥当的做法


### [7、读写分离有哪些解决方案？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#7读写分离有哪些解决方案)  


读写分离是依赖于主从复制，而主从复制又是为读写分离服务的。因为主从复制要求`slave`不能写只能读（如果对`slave`执行写操作，那么`show slave status`将会呈现`Slave_SQL_Running=NO`，此时你需要按照前面提到的手动同步一下`slave`）。

**方案一**

使用MySQL-proxy代理

**优点：**

直接实现读写分离和负载均衡，不用修改代码，master和slave用一样的帐号，MySQL官方不建议实际生产中使用

**缺点：**

降低性能， 不支持事务

**方案二**

**1、** 使用AbstractRoutingDataSource+aop+annotation在dao层决定数据源。

**2、** 如果采用了mybatis， 可以将读写分离放在ORM层，比如mybatis可以通过mybatis plugin拦截sql语句，所有的insert/update/delete都访问master库，所有的select 都访问salve库，这样对于dao层都是透明。 plugin实现时可以通过注解或者分析语句是读写方法来选定主从库。不过这样依然有一个问题， 也就是不支持事务， 所以我们还需要重写一下DataSourceTransactionManager， 将read-only的事务扔进读库， 其余的有读有写的扔进写库。

**方案三**

**1、** 使用AbstractRoutingDataSource+aop+annotation在service层决定数据源，可以支持事务.

**2、** 缺点：类内部方法通过this.xx()方式相互调用时，aop不会进行拦截，需进行特殊处理。


### [8、什么是幻读，脏读，不可重复读呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#8什么是幻读脏读不可重复读呢)  


**1、** 事务A、B交替执行，事务A被事务B干扰到了，因为事务A读取到事务B未提交的数据,这就是**脏读**

**2、** 在一个事务范围内，两个相同的查询，读取同一条记录，却返回了不同的数据，这就是**不可重复读**。

**3、** 事务A查询一个范围的结果集，另一个并发事务B往这个范围中插入/删除了数据，并静悄悄地提交，然后事务A再次查询相同的范围，两次读取得到的结果集不一样了，这就是**幻读**。


### [9、如果一个表有一列定义为TIMESTAMP，将发生什么？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#9如果一个表有一列定义为timestamp将发生什么)  


每当行被更改时，时间戳字段将获取当前时间戳。


### [10、SQL优化的一般步骤是什么，怎么看执行计划（explain），如何理解其中各个字段的含义。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题2021年，常见面试题及答案汇总.md#10sql优化的一般步骤是什么怎么看执行计划explain如何理解其中各个字段的含义。)  


**1、** show status 命令了解各种 sql 的执行频率

**2、** 通过慢查询日志定位那些执行效率较低的 sql 语句

**3、** explain 分析低效 sql 的执行计划（这点非常重要，日常开发中用它分析Sql，会大大降低Sql导致的线上事故）


### 11、什么是非标准字符串类型？

### 12、主键、外键和索引的区别？

### 13、数据库的乐观锁和悲观锁。

### 14、列的字符串类型可以是什么？

### 15、count(1)、count(*) 与 count(列名) 的区别？

### 16、可以使用多少列创建索引？

### 17、MYSQL数据库服务器性能分析的方法命令有哪些?

### 18、什么是死锁？怎么解决？

### 19、聚集索引与非聚集索引的区别

### 20、MySQL数据库cpu飙升到500%的话他怎么处理？

### 21、InnoDB存储引擎的锁的算法有三种

### 22、MySQL有哪些数据类型

### 23、B树和B+树的区别，数据库为什么使用B+树而不是B树？

### 24、从锁的类别上分MySQL都有哪些锁呢？

### 25、什么是游标？

### 26、SQL的执行顺序

### 27、事务的隔离级别有哪些？MySQL的默认隔离级别是什么？

### 28、一条sql执行过长的时间，你如何优化，从哪些方面入手？

### 29、FLOAT和DOUBLE的区别是什么？

### 30、什么是存储过程？有哪些优缺点？

### [1、MySQL数据库cpu飙升的话，要怎么处理呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#1mysql数据库cpu飙升的话要怎么处理呢)  


**排查过程：**

**1、** 使用top 命令观察，确定是MySQLd导致还是其他原因。

**2、** 如果是MySQLd导致的，show processlist，查看session情况，确定是不是有消耗资源的sql在运行。

**3、** 找出消耗高的 sql，看看执行计划是否准确， 索引是否缺失，数据量是否太大。

**处理：**

**1、** kill 掉这些线程(同时观察 cpu 使用率是否下降)，

**2、** 进行相应的调整(比如说加索引、改 sql、改内存参数)

**3、** 重新跑这些 SQL。

**其他情况：**

也有可能是每个 sql 消耗资源并不多，但是突然之间，有大量的 session 连进来导致 cpu 飙升，这种情况就需要跟应用一起来分析为何连接数会激增，再做出相应的调整，比如说限制连接数等


### [2、说说对SQL语句优化有哪些方法？（选择几条）](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#2说说对sql语句优化有哪些方法选择几条)  


**1、** Where子句中：where表之间的连接必须写在其他Where条件之前，那些可以过滤掉最大数量记录的条件必须写在Where子句的末尾.HAVING最后。

**2、** 用EXISTS替代IN、用NOT EXISTS替代NOT IN。

**3、**  避免在索引列上使用计算

**4、** 避免在索引列上使用IS NULL和IS NOT NULL

**5、** 对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。

**6、** 应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描

**7、** 应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描


### [3、Innodb的事务与日志的实现方式](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#3innodb的事务与日志的实现方式)  


**有多少种日志**

innodb两种日志redo和undo。

**日志的存放形式**

**1、** redo：在页修改的时候，先写到 redo log buffer 里面， 然后写到 redo log 的文件系统缓存里面(fwrite)，然后再同步到磁盘文件（ fsync）。

**2、** Undo：在 MySQL5.5 之前， undo 只能存放在 ibdata文件里面， 5.6 之后，可以通过设置 innodb_undo_tablespaces 参数把 undo log 存放在 ibdata之外。

**事务是如何通过日志来实现的**

**1、** 因为事务在修改页时，要先记 undo，在记 undo 之前要记 undo 的 redo， 然后修改数据页，再记数据页修改的 redo。 Redo（里面包括 undo 的修改） 一定要比数据页先持久化到磁盘。

**2、** 当事务需要回滚时，因为有 undo，可以把数据页回滚到前镜像的 状态，崩溃恢复时，如果 redo log 中事务没有对应的 commit 记录，那么需要用 undo把该事务的修改回滚到事务开始之前。

**3、** 如果有 commit 记录，就用 redo 前滚到该事务完成时并提交掉。


### [4、非聚簇索引一定会回表查询吗？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#4非聚簇索引一定会回表查询吗)  


不一定，如果查询语句的字段全部命中了索引，那么就不必再进行回表查询（哈哈，覆盖索引就是这么回事）。

举个简单的例子，假设我们在学生表的上建立了索引，那么当进行select age from student where age < 20的查询时，在索引的叶子节点上，已经包含了age信息，不会再次进行回表查询。


### [5、Hash索引和B+树所有有什么区别或者说优劣呢?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#5hash索引和b+树所有有什么区别或者说优劣呢)  


**1、** 首先要知道Hash索引和B+树索引的底层实现原理：

**2、** hash索引底层就是hash表，进行查找时，调用一次hash函数就可以获取到相应的键值，之后进行回表查询获得实际数据。B+树底层实现是多路平衡查找树。对于每一次的查询都是从根节点出发，查找到叶子节点方可以获得所查键值，然后根据查询判断是否需要回表查询数据。

**那么可以看出他们有以下的不同：**

**1、** hash索引进行等值查询更快(一般情况下)，但是却无法进行范围查询。

**2、** 因为在hash索引中经过hash函数建立索引之后，索引的顺序与原顺序无法保持一致，不能支持范围查询。而B+树的的所有节点皆遵循(左节点小于父节点，右节点大于父节点，多叉树也类似)，天然支持范围。

**3、** hash索引不支持使用索引进行排序，原理同上。

**4、** hash索引不支持模糊查询以及多列索引的最左前缀匹配。原理也是因为hash函数的不可预测。AAAA和AAAAB的索引没有相关性。

**5、** hash索引任何时候都避免不了回表查询数据，而B+树在符合某些条件(聚簇索引，覆盖索引等)的时候可以只通过索引完成查询。

**6、** hash索引虽然在等值查询上较快，但是不稳定。性能不可预测，当某个键值存在大量重复的时候，发生hash碰撞，此时效率可能极差。而B+树的查询效率比较稳定，对于所有的查询都是从根节点到叶子节点，且树的高度较低。

**7、** 因此，在大多数情况下，直接选择B+树索引可以获得稳定且较好的查询速度。而不需要使用hash索引。


### [6、select for update有什么含义，会锁表还是锁行还是其他。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#6select-for-update有什么含义会锁表还是锁行还是其他。)  


**select for update 含义**

select查询语句是不会加锁的，但是select for update除了有查询的作用外，还会加锁呢，而且它是悲观锁哦。至于加了是行锁还是表锁，这就要看是不是用了索引/主键啦。

没用索引/主键的话就是表锁，否则就是是行锁。

**select for update 加锁验证**

表结构：

```
//id 为主键，name为唯一索引
CREATE TABLE `account` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `balance` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`) USING BTREE
) ENGINE=InnoDB AUTO_INCREMENT=1570068 DEFAULT CHARSET=utf8
```

id为主键，select for update 1270070这条记录时，再开一个事务对该记录更新，发现更新阻塞啦，其实是加锁了。如下图：

![](https://user-gold-cdn.xitu.io/2020/5/23/1723f1df3f7cd93d?w=1338&h=337&f=png&s=47172#alt=)

我们再开一个事务对另外一条记录1270071更新，发现更新成功，因此，如果查询条件用了索引/主键，**会加行锁**~

![](https://user-gold-cdn.xitu.io/2020/5/23/1723f21ad2567560?w=1419&h=315&f=png&s=54135#alt=)

我们继续一路向北吧，换普通字段balance吧，发现又阻塞了。因此，没用索引/主键的话，**select for update加的就是表锁**

![](https://user-gold-cdn.xitu.io/2020/5/23/1723f297aeeb95d5?w=1421&h=384&f=png&s=56635#alt=)


### [7、你们数据库是否支持emoji表情存储，如果不支持，如何操作？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#7你们数据库是否支持emoji表情存储如果不支持如何操作)  


更换字符集utf8-->utf8mb4


### [8、索引的数据结构（b树，hash）](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#8索引的数据结构b树hash)  


索引的数据结构和具体存储引擎的实现有关，在MySQL中使用较多的索引有**Hash索引**，**B+树索引**等，而我们经常使用的InnoDB存储引擎的默认索引实现为：B+树索引。对于哈希索引来说，底层的数据结构就是哈希表，因此在绝大多数需求为单条记录查询的时候，可以选择哈希索引，查询性能最快；其余大部分场景，建议选择BTree索引。

**B树索引**

MySQL通过存储引擎取数据，基本上90%的人用的就是InnoDB了，按照实现方式分，InnoDB的索引类型目前只有两种：BTREE（B树）索引和HASH索引。B树索引是MySQL数据库中使用最频繁的索引类型，基本所有存储引擎都支持BTree索引。通常我们说的索引不出意外指的就是（B树）索引（实际是用B+树实现的，因为在查看表索引时，MySQL一律打印BTREE，所以简称为B树索引）

![99_1.png][99_1.png]

**查询方式：**

**1、** 主键索引区:PI(关联保存的时数据的地址)按主键查询,

**2、** 普通索引区:si(关联的id的地址,然后再到达上面的地址)。所以按主键查询,速度最快

**B+tree性质：**

**1、** n棵子tree的节点包含n个关键字，不用来保存数据而是保存数据的索引。

**2、** 所有的叶子结点中包含了全部关键字的信息，及指向含这些关键字记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。

**3、** 所有的非终端结点可以看成是索引部分，结点中仅含其子树中的最大（或最小）关键字。

**4、** B+ 树中，数据对象的插入和删除仅在叶节点上进行。

**5、** B+树有2个头指针，一个是树的根节点，一个是最小关键码的叶节点。

**哈希索引**

简要说下，类似于数据结构中简单实现的HASH表（散列表）一样，当我们在MySQL中用哈希索引时，主要就是通过Hash算法（常见的Hash算法有直接定址法、平方取中法、折叠法、除数取余法、随机数法），将数据库字段数据转换成定长的Hash值，与这条数据的行指针一并存入Hash表的对应位置；如果发生Hash碰撞（两个不同关键字的Hash值相同），则在对应Hash键下以链表形式存储。当然这只是简略模拟图。

![99_2.png][99_2.png]


### [9、最左匹配原则？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#9最左匹配原则)  


在创建联合索引时候，一般需要遵循最左匹配原则。即联合索引中的属性识别度最高的放在查询语句的最前面。


### [10、对于关系型数据库而言，索引是相当重要的概念，请回答有关索引的几个问题：](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，2021年面试题及答案汇总.md#10对于关系型数据库而言索引是相当重要的概念请回答有关索引的几个问题：)  


1.索引的目的是什么？

快速访问数据表中的特定信息，提高检索速度

创建唯一性索引，保证数据库表中每一行数据的唯一性。

加速表和表之间的连接

使用分组和排序子句进行数据检索时，可以显著减少查询中分组和排序的时间

2.索引对数据库系统的负面影响是什么？

负面影响：

创建索引和维护索引需要耗费时间，这个时间随着数据量的增加而增加；索引需要占用物理空间，不光是表需要占用数据空间，每个索引也需要占用物理空间；当对表进行增、删、改、的时候索引也要动态维护，这样就降低了数据的维护速度。

3.为数据表建立索引的原则有哪些？

在最频繁使用的、用以缩小查询范围的字段上建立索引。

在频繁使用的、需要排序的字段上建立索引

4.什么情况下不宜建立索引？

对于查询中很少涉及的列或者重复值比较多的列，不宜建立索引。

对于一些特殊的数据类型，不宜建立索引，比如文本字段（text）等


### 11、关心过业务系统里面的sql耗时吗？统计过慢查询吗？对慢查询都怎么优化过？

### 12、如何优化长难的查询语句

### 13、联合索引是什么？为什么需要注意联合索引中的顺序？

### 14、什么是通用SQL函数？

### 15、谈谈MySQL的Explain

### 16、MySQL 遇到过死锁问题吗，你是如何解决的？

### 17、优化LIMIT分页

### 18、UNION与UNION ALL的区别？

### 19、什么是游标？

### 20、什么是子查询

### 21、MySQL 分页

### 22、limit 1000000 加载很慢的话，你是怎么解决的呢？

### 23、Innodb的事务与日志的实现方式

### 24、索引是什么?

### 25、SQL的生命周期？

### 26、锁的优化策略

### 27、读写分离常见方案？

### 28、什么是SQL？

### 29、MySQL存储引擎MyISAM与InnoDB区别

### 30、MYSQL的主从延迟，你怎么解决？

### [1、超大分页怎么处理？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#1超大分页怎么处理)  


**超大的分页一般从两个方向上来解决.**

**1、** 数据库层面,这也是我们主要集中关注的(虽然收效没那么大),类似于`select * from table where age > 20 limit 1000000,10`这种查询其实也是有可以优化的余地的、这条语句需要load1000000数据然后基本上全部丢弃,只取10条当然比较慢、当时我们可以修改为`select * from table where id in (select id from table where age > 20 limit 1000000,10)`.这样虽然也load了一百万的数据,但是由于索引覆盖,要查询的所有字段都在索引中,所以速度会很快、同时如果ID连续的好,我们还可以`select * from table where id > 1000000 limit 10`,效率也是不错的,优化的可能性有许多种,但是核心思想都一样,就是减少load的数据.

**2、** 从需求的角度减少这种请求…主要是不做类似的需求(直接跳转到几百万页之后的具体某一页.只允许逐页查看或者按照给定的路线走,这样可预测,可缓存)以及防止ID泄漏且连续被人恶意攻击.

解决超大分页,其实主要是靠缓存,可预测性的提前查到内容,缓存至Redis等k-V数据库中,直接返回即可


### [2、存储引擎分类有哪些以及使用场景？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#2存储引擎分类有哪些以及使用场景)  


**存储引擎主要有**

**1、** MyIsam

**2、** InnoDB

**3、** Memory

**4、** Archive

**5、** Federated

默认为:InnoDB 引擎。InnoDB 底层存储结构为 B+树， B 树的每个节点对应 innodb

的一个 page，page 大小是固定的，一般设为 16k

**使用场景**

**1、** 经常更新的表，适合处理多重并发的更新请求

**2、** 支持事务。

**3、** 可以从灾难中恢复(通过 bin-log 日志等)

**4、** 外键约束。只有他支持外键。

**5、** 支持自动增加列属性 auto_increment


### [3、视图有哪些特点？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#3视图有哪些特点)  


**视图的特点如下:**

**1、** 视图的列可以来自不同的表，是表的抽象和在逻辑意义上建立的新关系。

**2、** 视图是由基本表(实表)产生的表(虚表)。

**3、** 视图的建立和删除不影响基本表。

**4、** 对视图内容的更新(添加，删除和修改)直接影响基本表。

**5、** 当视图来自多个基本表时，不允许添加和删除数据。

视图的操作包括创建视图，查看视图，删除视图和修改视图。


### [4、什么是存储过程？有哪些优缺点？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#4什么是存储过程有哪些优缺点)  


「存储过程」，就是一些编译好了的SQL语句，这些SQL语句代码像一个方法一样实现一些功能（对单表或多表的增删改查），然后给这些代码块取一个名字，在用到这个功能的时候调用即可。

**「优点：」**

**1、** 存储过程是一个预编译的代码块，执行效率比较高

**2、** 存储过程在服务器端运行，减少客户端的压力

**3、** 允许模块化程序设计，只需要创建一次过程，以后在程序中就可以调用该过程任意次，类似方法的复用

**4、** 一个存储过程替代大量T_SQL语句 ，可以降低网络通信量，提高通信速率

**5、** 可以一定程度上确保数据安全

**「缺点：」**

**1、** 调试麻烦

**2、** 可移植性不灵活

**3、** 重新编译问题



### [5、日常工作中你是怎么优化SQL的？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#5日常工作中你是怎么优化sql的)  


可以从这几个维度回答这个问题：

**1、** 加索引

**2、** 避免返回不必要的数据

**3、** 适当分批量进行

**4、** 优化sql结构

**5、** 分库分表

**6、** 读写分离


### [6、创建索引的原则](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#6创建索引的原则)  


**索引虽好，但也不是无限制的使用，最好符合一下几个原则**

**1、** 最左前缀匹配原则，组合索引非常重要的原则，MySQL会一直向右匹配直到遇到范围查询(>、<、between、like)就停止匹配，比如a = 1 and b = 2 and c > 3 and d = 4 如果建立(a,b,c,d)顺序的索引，d是用不到索引的，如果建立(a,b,d,c)的索引则都可以用到，a,b,d的顺序可以任意调整。

**2、** 较频繁作为查询条件的字段才去创建索引

**3、** 更新频繁字段不适合创建索引

**4、** 若是不能有效区分数据的列不适合做索引列(如性别，男女未知，最多也就三种，区分度实在太低)

**5、** 尽量的扩展索引，不要新建索引。比如表中已经有a的索引，现在要加(a,b)的索引，那么只需要修改原来的索引即可。

**6、** 定义有外键的数据列一定要建立索引。

**7、** 对于那些查询中很少涉及的列，重复值比较多的列不要建立索引。

**8、** 对于定义为text、image和bit的数据类型的列不要建立索引。


### [7、什么是死锁？怎么解决？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#7什么是死锁怎么解决)  


死锁是指两个或多个事务在同一资源上相互占用，并请求锁定对方的资源，从而导致恶性循环的现象。

**常见的解决死锁的方法**

**1、** 如果不同程序会并发存取多个表，尽量约定以相同的顺序访问表，可以大大降低死锁机会。

**2、** 在同一个事务中，尽可能做到一次锁定所需要的所有资源，减少死锁产生概率；

**3、** 对于非常容易产生死锁的业务部分，可以尝试使用升级锁定颗粒度，通过表级锁定来减少死锁产生的概率；

如果业务不好处理,可以用分布式事务锁或者使用乐观锁


### [8、为表中得字段选择合适得数据类型](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#8为表中得字段选择合适得数据类型)  


字段类型优先级: 整形>date,time>enum,char>varchar>blob,text

优先考虑数字类型，其次是日期或者二进制类型，最后是字符串类型，同级别得数据类型，应该优先选择占用空间小的数据类型


### [9、MySQL 索引使用有哪些注意事项呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#9mysql-索引使用有哪些注意事项呢)  


可以从三个维度回答这个问题：索引哪些情况会失效，索引不适合哪些场景，索引规则

**索引哪些情况会失效**

**1、** 查询条件包含or，可能导致索引失效

**2、** 如何字段类型是字符串，where时一定用引号括起来，否则索引失效

**3、** like通配符可能导致索引失效。

**4、** 联合索引，查询时的条件列不是联合索引中的第一个列，索引失效。

**5、** 在索引列上使用MySQL的内置函数，索引失效。

**6、** 对索引列运算（如，+、-、*、/），索引失效。

**7、** 索引字段上使用（！= 或者 < >，not in）时，可能会导致索引失效。

**8、** 索引字段上使用is null， is not null，可能导致索引失效。

**9、** 左连接查询或者右连接查询查询关联的字段编码格式不一样，可能导致索引失效。

**10、** MySQL估计使用全表扫描要比使用索引快,则不使用索引。

**索引不适合哪些场景**

**1、** 数据量少的不适合加索引

**2、** 更新比较频繁的也不适合加索引

**3、** 区分度低的字段不适合加索引（如性别）

**索引的一些潜规则**

**1、** 覆盖索引

2、回表

**3、** 索引数据结构（B+树）

**4、** 最左前缀原则

**5、** 索引下推


### [10、什么是锁？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题，常见面试题及答案汇总.md#10什么是锁)  


数据库是一个多用户使用的共享资源。当多个用户并发地存取数据时，在数据库中就会产生多个事务同时存取同一数据的情况。若对并发操作不加控制就可能会读取和存储不正确的数据，破坏数据库的一致性。

加锁是实现数据库并发控制的一个非常重要的技术。当事务在对某个数据对象进行操作前，先向系统发出请求，对其加锁。加锁后事务就对该数据对象有了一定的控制，在该事务释放锁之前，其他的事务不能对此数据对象进行更新操作。

**基本锁类型：锁包括行级锁和表级锁**


### 11、索引有哪几种类型？

### 12、组合索引是什么？为什么需要注意组合索引中的顺序？

### 13、MySQL中InnoDB支持的四种事务隔离级别名称，以及逐级之间的区别？

### 14、MySQL如何获取当前日期？

### 15、关心过业务系统里面的sql耗时吗？统计过慢查询吗？对慢查询都怎么优化过？

### 16、MySQL中 in 和 exists 区别

### 17、MySQL中DATETIME和TIMESTAMP的区别

### 18、简单描述MySQL中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响（从读写两方面）

### 19、列的字符串类型可以是什么？

### 20、MySQL中in 和exists的区别。

### 21、为什么要使用视图？什么是视图？

### 22、什么是非标准字符串类型？

### 23、创建索引时需要注意什么？

### 24、简单总结下

### 25、如果要存储用户的密码散列，应该使用什么字段进行存储？

### 26、SQL注入漏洞产生的原因？如何防止？

### 27、说一下数据库的三大范式

### 28、什么是基本表？什么是视图？

### 29、索引设计的原则？

### 30、索引有哪些优缺点？



### [1、在高并发情况下，如何做到安全的修改同一行数据？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#1在高并发情况下如何做到安全的修改同一行数据)  


要安全的修改同一行数据，就要保证一个线程在修改时其它线程无法更新这行记录。一般有悲观锁和乐观锁两种方案~


### [2、索引有哪些优缺点？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#2索引有哪些优缺点)  


**索引的优点**

**1、** 可以大大加快数据的检索速度，这也是创建索引的最主要的原因。

**2、** 通过使用索引，可以在查询的过程中，使用优化隐藏器，提高系统的性能。

**索引的缺点**

**1、** 时间方面：创建索引和维护索引要耗费时间，具体地，当对表中的数据进行增加、删除和修改的时候，索引也要动态的维护，会降低增/改/删的执行效率；

**2、** 空间方面：索引需要占物理空间。


### [3、非聚簇索引一定会回表查询吗？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#3非聚簇索引一定会回表查询吗)  


不一定，这涉及到查询语句所要求的字段是否全部命中了索引，如果全部命中了索引，那么就不必再进行回表查询。

**举个简单的例子**

假设我们在员工表的年龄上建立了索引，那么当进行`select age from employee where age < 20`的查询时，在索引的叶子节点上，已经包含了age信息，不会再次进行回表查询。


### [4、MySQL数据库cpu飙升的话，要怎么处理呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#4mysql数据库cpu飙升的话要怎么处理呢)  


**「排查过程：」**

使用top 命令观察，确定是MySQLd导致还是其他原因。

如果是MySQLd导致的，show processlist，查看session情况，确定是不是有消耗资源的sql在运行。

找出消耗高的 sql，看看执行计划是否准确， 索引是否缺失，数据量是否太大。

**「处理：」**

kill 掉这些线程(同时观察 cpu 使用率是否下降)，

进行相应的调整(比如说加索引、改 sql、改内存参数)

重新跑这些 SQL。

**「其他情况：」**

也有可能是每个 sql 消耗资源并不多，但是突然之间，有大量的 session 连进来导致 cpu 飙升，这种情况就需要跟应用一起来分析为何连接数会激增，再做出相应的调整，比如说限制连接数等


### [5、Hash索引和B+树区别是什么？你在设计索引是怎么抉择的？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#5hash索引和b+树区别是什么你在设计索引是怎么抉择的)  


**1、** B+树可以进行范围查询，Hash索引不能。

**2、** B+树支持联合索引的最左侧原则，Hash索引不支持。

**3、** B+树支持order by排序，Hash索引不支持。

**4、** Hash索引在等值查询上比B+树效率更高。

**5、** B+树使用like 进行模糊查询的时候，like后面（比如%开头）的话可以起到优化的作用，Hash索引根本无法进行模糊查询。


### [6、数据库自增主键可能遇到什么问题。](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#6数据库自增主键可能遇到什么问题。)  


**1、** 使用自增主键对数据库做分库分表，可能出现诸如主键重复等的问题。解决方案的话，简单点的话可以考虑使用UUID哈

**2、** 自增主键会产生表锁，从而引发问题

**3、** 自增主键可能用完问题。


### [7、事务特性：](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#7事务特性：)  


（1）原子性：即不可分割性，事务要么全部被执行，要么就全部不被执行。

（2）一致性或可串性。事务的执行使得数据库从一种正确状态转换成另一种正确状态

（3）隔离性。在事务正确提交之前，不允许把该事务对数据的任何改变提供给任何其他事务，

（4） 持久性。事务正确提交后，其结果将永久保存在数据库中，即使在事务提交后有了其他故障，事务的处理结果也会得到保存。

或者这样理解：

事务就是被绑定在一起作为一个逻辑工作单元的SQL语句分组，如果任何一个语句操作失败那么整个操作就被失败，以后操作就会回滚到操作前状态，或者是上有个节点。为了确保要么执行，要么不执行，就可以使用事务。要将有组语句作为事务考虑，就需要通过ACID测试，即原子性，一致性，隔离性和持久性。


### [8、优化数据库的方法](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#8优化数据库的方法)  


**1、** 选取最适用的字段属性，尽可能减少定义字段宽度，尽量把字段设置NOTNULL，例如’省份’、’性别’最好适用ENUM

**2、** 使用连接(JOIN)来代替子查询

**3、** 适用联合(UNION)来代替手动创建的临时表

**4、** 事务处理

**5、** 锁定表、优化事务处理

**6、** 适用外键，优化锁定表

**7、** 建立索引

**8、** 优化查询语句


### [9、MySQL中int(10)和char(10)以及varchar(10)的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#9mysql中int10和char10以及varchar10的区别)  


**1、** int(10)的10表示显示的数据的长度，不是存储数据的大小；chart(10)和varchar(10)的10表示存储数据的大小，即表示存储多少个字符。

**2、** char(10)表示存储定长的10个字符，不足10个就用空格补齐，占用更多的存储空间

**3、** varchar(10)表示存储10个变长的字符，存储多少个就是多少个，空格也按一个字符存储，这一点是和char(10)的空格不同的，char(10)的空格表示占位不算一个字符


### [10、简述在MySQL数据库中MyISAM和InnoDB的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案附答案汇总.md#10简述在mysql数据库中myisam和innodb的区别)  


**MyISAM：**

不支持事务，但是每次查询都是原子的；

支持表级锁，即每次操作是对整个表加锁；

**存储表的总行数；**

一个MYISAM表有三个文件：索引文件、表结构文件、数据文件；

采用菲聚集索引，索引文件的数据域存储指向数据文件的指针。辅索引与主索引基本一致，但是辅索引不用保证唯一性。

**InnoDb：**

支持ACID的事务，支持事务的四种隔离级别；

支持行级锁及外键约束：因此可以支持写并发；

**不存储总行数：**

一个InnoDb引擎存储在一个文件空间（共享表空间，表大小不受操作系统控制，一个表可能分布在多个文件里），也有可能为多个（设置为独立表空，表大小受操作系统文件大小限制，一般为2G），受操作系统文件大小的限制；

主键索引采用聚集索引（索引的数据域存储数据文件本身），辅索引的数据域存储主键的值；因此从辅索引查找数据，需要先通过辅索引找到主键值，再访问辅索引；最好使用自增主键，防止插入数据时，为维持B+树结构，文件的大调整。


### 11、数据库经常使用的函数

### 12、创建索引的三种方式

### 13、优化UNION查询

### 14、InnoDB引擎中的索引策略，了解过吗？

### 15、MySQL 索引使用有哪些注意事项呢？

### 16、一条SQL语句在MySQL中如何执行的？

### 17、覆盖索引是什么？

### 18、怎样才能找出最后一次插入时分配了哪个自动增量？

### 19、按照锁的粒度分数据库锁有哪些？锁机制与InnoDB锁算法

### 20、为表中得字段选择合适得数据类型

### 21、如何通俗地理解三个范式？

### 22、什么叫视图？游标是什么？

### 23、数据库中的事务是什么?

### 24、视图的优点

### 25、MySQL中InnoDB支持的四种事务隔离级别名称，以及逐级之间的区别？

### 26、MySQL驱动程序是什么？

### 27、MySQL事务得四大特性以及实现原理

### 28、什么是触发器？触发器的使用场景有哪些？

### 29、InnoDB与MyISAM的区别

### 30、一条SQL语句在MySQL中如何执行的？

### [1、MySQL中DATETIME和TIMESTAMP的区别](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#1mysql中datetime和timestamp的区别)  


存储精度都为秒

**区别：**

**1、** DATETIME 的日期范围是 1001——9999 年；TIMESTAMP 的时间范围是 1970——2038 年

**2、** DATETIME 存储时间与时区无关；TIMESTAMP 存储时间与时区有关，显示的值也依赖于时区

**3、** DATETIME 的存储空间为 8 字节；TIMESTAMP 的存储空间为 4 字节

**4、** DATETIME 的默认值为 null；TIMESTAMP 的字段默认不为空(not null)，默认值为当前时间(CURRENT_TIMESTAMP)


### [2、简单描述MySQL中，索引，主键，唯一索引，联合索引的区别，对数据库的性能有什么影响（从读写两方面）](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#2简单描述mysql中索引主键唯一索引联合索引的区别对数据库的性能有什么影响从读写两方面)  


索引是一种特殊的文件(InnoDB数据表上的索引是表空间的一个组成部分)，它们包含着对数据表里所有记录的引用指针。

普通索引(由关键字KEY或INDEX定义的索引)的唯一任务是加快对数据的访问速度。

普通索引允许被索引的数据列包含重复的值。如果能确定某个数据列将只包含彼此各不相同的值，在为这个数据列创建索引的时候就应该用关键字UNIQUE把它定义为一个唯一索引。也就是说，唯一索引可以保证数据记录的唯一性。

主键，是一种特殊的唯一索引，在一张表中只能定义一个主键索引，主键用于唯一标识一条记录，使用关键字 PRIMARY KEY 来创建。

索引可以覆盖多个数据列，如像INDEX(columnA, columnB)索引，这就是联合索引。

索引可以极大的提高数据的查询速度，但是会降低插入、删除、更新表的速度，因为在执行这些写操作时，还要操作索引文件。


### [3、什么是SQL？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#3什么是sql)  


结构化查询语言(Structured Query Language)简称SQL，是一种数据库查询语言。

**作用：**

用于存取数据、查询、更新和管理关系数据库系统。


### [4、MyISAM表格将在哪里存储，并且还提供其存储格式？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#4myisam表格将在哪里存储并且还提供其存储格式)  


**每个MyISAM表格以三种格式存储在磁盘上：**

**1、** ·“.frm”文件存储表定义

**2、** ·数据文件具有“.MYD”（MYData）扩展名

**3、** 索引文件具有“.MYI”（MYIndex）扩展名


### [5、MySQL支持事务吗？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#5mysql支持事务吗)  


在缺省模式下，MySQL是autocommit模式的，所有的数据库更新操作都会即时提交，所以在缺省情况下，MySQL是不支持事务的。

但是如果你的MySQL表类型是使用InnoDB Tables 或 BDB tables的话，你的MySQL就可以使用事务处理,使用SET

AUTOCOMMIT=0就可以使MySQL允许在非autocommit模式，在非autocommit模式下，你必须使用COMMIT来提交你的更改，或者用ROLLBACK来回滚你的更改。


### [6、从锁的类别角度讲，MySQL都有哪些锁呢？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#6从锁的类别角度讲mysql都有哪些锁呢)  


**从锁的类别上来讲，有共享锁和排他锁**

**1、** 共享锁: 又叫做读锁。当用户要进行数据的读取时，对数据加上共享锁。共享锁可以同时加上多个。

**2、** 排他锁: 又叫做写锁。当用户要进行数据的写入时，对数据加上排他锁。排他锁只可以加一个，他和其他的排他锁，共享锁都相斥。

锁兼容性如下：

![](https://user-gold-cdn.xitu.io/2020/5/23/172412db1d202759?w=1045&h=229&f=png&s=68561#alt=)


### [7、MVCC熟悉吗，它的底层原理？](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#7mvcc熟悉吗它的底层原理)  


MVCC,多版本并发控制,它是通过读取历史版本的数据，来降低并发事务冲突，从而提高并发性能的一种机制。

**「MVCC需要关注这几个知识点：」**

**1、** 事务版本号

**2、** 表的隐藏列

**3、** undo log

**4、** read view


### [8、存储时期](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#8存储时期)  


**1、** `Datatime:以 YYYY-MM-DD HH:MM:SS` 格式存储时期时间，精确到秒，占用8个字节得存储空间，datatime类型与时区无关

**2、** Timestamp:以时间戳格式存储，占用4个字节，范围小1970-1-1到2038-1-19，显示依赖于所指定得时区，默认在第一个列行的数据修改时可以自动得修改timestamp列得值

**3、** Date:（生日）占用得字节数比使用字符串.datatime.int储存要少，使用date只需要3个字节，存储日期月份，还可以利用日期时间函数进行日期间得计算

**4、** Time:存储时间部分得数据

**5、** 注意:不要使用字符串类型来存储日期时间数据（通常比字符串占用得储存空间小，在进行查找过滤可以利用日期得函数）

**6、** 使用int存储日期时间不如使用timestamp类型


### [9、什么是MySQL?](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#9什么是mysql)  


MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。在Java企业级开发中非常常用，因为 MySQL 是开源免费的，并且方便扩展。


### [10、MySQL的复制原理以及流程](https://gitee.com/souyunku/DevBooks/blob/master/docs/MySQL/MySQL最新面试题及答案整理，汇总版.md#10mysql的复制原理以及流程)  


「主从复制原理，简言之，就三步曲，如下：」

**1、** 主数据库有个bin-log二进制文件，纪录了所有增删改Sql语句。（binlog线程）

**2、** 从数据库把主数据库的bin-log文件的sql语句复制过来。（io线程）

**3、** 从数据库的relay-log重做日志文件中再执行一次这些sql语句。（Sql执行线程）

**上图主从复制分了五个步骤进行：**

步骤一：主库的更新事件(update、insert、delete)被写到binlog

步骤二：从库发起连接，连接到主库。

步骤三：此时主库创建一个binlog dump thread，把binlog的内容发送到从库。

步骤四：从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log

步骤五：还会创建一个SQL线程，从relay log里面读取内容，从Exec_Master_Log_Pos位置开始执行读取到的更新事件，将更新内容写入到slave的db


### 11、如何优化查询过程中的数据访问

### 12、如果某个表有近千万数据，CRUD比较慢，如何优化。

### 13、如果要存储用户的密码散列，应该使用什么字段进行存储？

### 14、数据库存储日期格式时，如何考虑时区转换问题？

### 15、使用B+树的好处

### 16、视图的缺点

### 17、数据库结构优化

### 18、索引有哪些优缺点？

### 19、非主键索引一定会查询多次吗？

### 20、按照锁的粒度分，数据库锁有哪些呢？锁机制与InnoDB锁算法

### 21、为什么要使用数据库

### 22、如何通俗地理解三个范式？

### 23、说说MySQL 的基础架构图

### 24、什么是索引？

### 25、数据库索引的原理，为什么要用 B+树，为什么不用二叉树？

### 26、SQL语句主要分为哪几类

### 27、覆盖索引、回表等这些，了解过吗？

### 28、什么是聚簇索引？何时使用聚簇索引与非聚簇索引

### 29、Innodb的事务实现原理？

### 30、MySQL中InnoDB引擎的行锁是怎么实现的？